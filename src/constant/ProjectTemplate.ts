import { decodeBase64 } from '@/utility/utils';
import { BlankContract } from './template/BlankContract';
import { CounterContract } from './template/CounterContract';

import {
  TactBlankContract,
  TactCounterContract,
} from './template/tact/contracts';

const stdlibContent = `OzsgU3RhbmRhcmQgbGlicmFyeSBmb3IgZnVuQwo7OwoKey0KICAjIFR1cGxlIG1hbmlwdWxhdGlvbiBwcmltaXRpdmVzCiAgVGhlIG5hbWVzIGFuZCB0aGUgdHlwZXMgYXJlIG1vc3RseSBzZWxmLWV4cGxhaW5pbmcuCiAgU2VlIFtwb2x5bW9yaGlzbSB3aXRoIGZvcmFsbF0oaHR0cHM6Ly90b24ub3JnL2RvY3MvIy9mdW5jL2Z1bmN0aW9ucz9pZD1wb2x5bW9ycGhpc20td2l0aC1mb3JhbGwpCiAgZm9yIG1vcmUgaW5mbyBvbiB0aGUgcG9seW1vcnBoaWMgZnVuY3Rpb25zLgoKICBOb3RlIHRoYXQgY3VycmVudGx5IHZhbHVlcyBvZiBhdG9taWMgdHlwZSBgdHVwbGVgIGNhbid0IGJlIGNhc3QgdG8gY29tcG9zaXRlIHR1cGxlIHR5cGUgKGUuZy4gYFtpbnQsIGNlbGxdYCkKICBhbmQgdmlzZSB2ZXJzYS4KLX0KCnstCiAgIyBMaXNwLXN0eWxlIGxpc3RzCgogIExpc3RzIGNhbiBiZSByZXByZXNlbnRlZCBhcyBuZXN0ZWQgMi1lbGVtZW50cyB0dXBsZXMuCiAgRW1wdHkgbGlzdCBpcyBjb252ZW50aW9uYWxseSByZXByZXNlbnRlZCBhcyBUVk0gYG51bGxgIHZhbHVlIChpdCBjYW4gYmUgb2J0YWluZWQgYnkgY2FsbGluZyBbbnVsbCgpXSkuCiAgRm9yIGV4YW1wbGUsIHR1cGxlIGAoMSwgKDIsICgzLCBudWxsKSkpYCByZXByZXNlbnRzIGxpc3QgYFsxLCAyLCAzXWAuIEVsZW1lbnRzIG9mIGEgbGlzdCBjYW4gYmUgb2YgZGlmZmVyZW50IHR5cGVzLgotfQoKOzs7IEFkZHMgYW4gZWxlbWVudCB0byB0aGUgYmVnaW5uaW5nIG9mIGxpc3Atc3R5bGUgbGlzdC4KZm9yYWxsIFggLT4gdHVwbGUgY29ucyhYIGhlYWQsIHR1cGxlIHRhaWwpIGFzbSAiQ09OUyI7Cgo7OzsgRXh0cmFjdHMgdGhlIGhlYWQgYW5kIHRoZSB0YWlsIG9mIGxpc3Atc3R5bGUgbGlzdC4KZm9yYWxsIFggLT4gKFgsIHR1cGxlKSB1bmNvbnModHVwbGUgbGlzdCkgYXNtICJVTkNPTlMiOwoKOzs7IEV4dHJhY3RzIHRoZSB0YWlsIGFuZCB0aGUgaGVhZCBvZiBsaXNwLXN0eWxlIGxpc3QuCmZvcmFsbCBYIC0+ICh0dXBsZSwgWCkgbGlzdF9uZXh0KHR1cGxlIGxpc3QpIGFzbSggLT4gMSAwKSAiVU5DT05TIjsKCjs7OyBSZXR1cm5zIHRoZSBoZWFkIG9mIGxpc3Atc3R5bGUgbGlzdC4KZm9yYWxsIFggLT4gWCBjYXIodHVwbGUgbGlzdCkgYXNtICJDQVIiOwoKOzs7IFJldHVybnMgdGhlIHRhaWwgb2YgbGlzcC1zdHlsZSBsaXN0Lgp0dXBsZSBjZHIodHVwbGUgbGlzdCkgYXNtICJDRFIiOwoKOzs7IENyZWF0ZXMgdHVwbGUgd2l0aCB6ZXJvIGVsZW1lbnRzLgp0dXBsZSBlbXB0eV90dXBsZSgpIGFzbSAiTklMIjsKCjs7OyBBcHBlbmRzIGEgdmFsdWUgYHhgIHRvIGEgYFR1cGxlIHQgPSAoeDEsIC4uLiwgeG4pYCwgYnV0IG9ubHkgaWYgdGhlIHJlc3VsdGluZyBgVHVwbGUgdCcgPSAoeDEsIC4uLiwgeG4sIHgpYAo7OzsgaXMgb2YgbGVuZ3RoIGF0IG1vc3QgMjU1LiBPdGhlcndpc2UgdGhyb3dzIGEgdHlwZSBjaGVjayBleGNlcHRpb24uCmZvcmFsbCBYIC0+IHR1cGxlIHRwdXNoKHR1cGxlIHQsIFggdmFsdWUpIGFzbSAiVFBVU0giOwpmb3JhbGwgWCAtPiAodHVwbGUsICgpKSB+dHB1c2godHVwbGUgdCwgWCB2YWx1ZSkgYXNtICJUUFVTSCI7Cgo7OzsgQ3JlYXRlcyBhIHR1cGxlIG9mIGxlbmd0aCBvbmUgd2l0aCBnaXZlbiBhcmd1bWVudCBhcyBlbGVtZW50Lgpmb3JhbGwgWCAtPiBbWF0gc2luZ2xlKFggeCkgYXNtICJTSU5HTEUiOwoKOzs7IFVucGFja3MgYSB0dXBsZSBvZiBsZW5ndGggb25lCmZvcmFsbCBYIC0+IFggdW5zaW5nbGUoW1hdIHQpIGFzbSAiVU5TSU5HTEUiOwoKOzs7IENyZWF0ZXMgYSB0dXBsZSBvZiBsZW5ndGggdHdvIHdpdGggZ2l2ZW4gYXJndW1lbnRzIGFzIGVsZW1lbnRzLgpmb3JhbGwgWCwgWSAtPiBbWCwgWV0gcGFpcihYIHgsIFkgeSkgYXNtICJQQUlSIjsKCjs7OyBVbnBhY2tzIGEgdHVwbGUgb2YgbGVuZ3RoIHR3bwpmb3JhbGwgWCwgWSAtPiAoWCwgWSkgdW5wYWlyKFtYLCBZXSB0KSBhc20gIlVOUEFJUiI7Cgo7OzsgQ3JlYXRlcyBhIHR1cGxlIG9mIGxlbmd0aCB0aHJlZSB3aXRoIGdpdmVuIGFyZ3VtZW50cyBhcyBlbGVtZW50cy4KZm9yYWxsIFgsIFksIFogLT4gW1gsIFksIFpdIHRyaXBsZShYIHgsIFkgeSwgWiB6KSBhc20gIlRSSVBMRSI7Cgo7OzsgVW5wYWNrcyBhIHR1cGxlIG9mIGxlbmd0aCB0aHJlZQpmb3JhbGwgWCwgWSwgWiAtPiAoWCwgWSwgWikgdW50cmlwbGUoW1gsIFksIFpdIHQpIGFzbSAiVU5UUklQTEUiOwoKOzs7IENyZWF0ZXMgYSB0dXBsZSBvZiBsZW5ndGggZm91ciB3aXRoIGdpdmVuIGFyZ3VtZW50cyBhcyBlbGVtZW50cy4KZm9yYWxsIFgsIFksIFosIFcgLT4gW1gsIFksIFosIFddIHR1cGxlNChYIHgsIFkgeSwgWiB6LCBXIHcpIGFzbSAiNCBUVVBMRSI7Cgo7OzsgVW5wYWNrcyBhIHR1cGxlIG9mIGxlbmd0aCBmb3VyCmZvcmFsbCBYLCBZLCBaLCBXIC0+IChYLCBZLCBaLCBXKSB1bnR1cGxlNChbWCwgWSwgWiwgV10gdCkgYXNtICI0IFVOVFVQTEUiOwoKOzs7IFJldHVybnMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYSB0dXBsZSAod2l0aCB1bmtub3duIGVsZW1lbnQgdHlwZXMpLgpmb3JhbGwgWCAtPiBYIGZpcnN0KHR1cGxlIHQpIGFzbSAiRklSU1QiOwoKOzs7IFJldHVybnMgdGhlIHNlY29uZCBlbGVtZW50IG9mIGEgdHVwbGUgKHdpdGggdW5rbm93biBlbGVtZW50IHR5cGVzKS4KZm9yYWxsIFggLT4gWCBzZWNvbmQodHVwbGUgdCkgYXNtICJTRUNPTkQiOwoKOzs7IFJldHVybnMgdGhlIHRoaXJkIGVsZW1lbnQgb2YgYSB0dXBsZSAod2l0aCB1bmtub3duIGVsZW1lbnQgdHlwZXMpLgpmb3JhbGwgWCAtPiBYIHRoaXJkKHR1cGxlIHQpIGFzbSAiVEhJUkQiOwoKOzs7IFJldHVybnMgdGhlIGZvdXJ0aCBlbGVtZW50IG9mIGEgdHVwbGUgKHdpdGggdW5rbm93biBlbGVtZW50IHR5cGVzKS4KZm9yYWxsIFggLT4gWCBmb3VydGgodHVwbGUgdCkgYXNtICIzIElOREVYIjsKCjs7OyBSZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50IG9mIGEgcGFpciB0dXBsZS4KZm9yYWxsIFgsIFkgLT4gWCBwYWlyX2ZpcnN0KFtYLCBZXSBwKSBhc20gIkZJUlNUIjsKCjs7OyBSZXR1cm5zIHRoZSBzZWNvbmQgZWxlbWVudCBvZiBhIHBhaXIgdHVwbGUuCmZvcmFsbCBYLCBZIC0+IFkgcGFpcl9zZWNvbmQoW1gsIFldIHApIGFzbSAiU0VDT05EIjsKCjs7OyBSZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50IG9mIGEgdHJpcGxlIHR1cGxlLgpmb3JhbGwgWCwgWSwgWiAtPiBYIHRyaXBsZV9maXJzdChbWCwgWSwgWl0gcCkgYXNtICJGSVJTVCI7Cgo7OzsgUmV0dXJucyB0aGUgc2Vjb25kIGVsZW1lbnQgb2YgYSB0cmlwbGUgdHVwbGUuCmZvcmFsbCBYLCBZLCBaIC0+IFkgdHJpcGxlX3NlY29uZChbWCwgWSwgWl0gcCkgYXNtICJTRUNPTkQiOwoKOzs7IFJldHVybnMgdGhlIHRoaXJkIGVsZW1lbnQgb2YgYSB0cmlwbGUgdHVwbGUuCmZvcmFsbCBYLCBZLCBaIC0+IFogdHJpcGxlX3RoaXJkKFtYLCBZLCBaXSBwKSBhc20gIlRISVJEIjsKCgo7OzsgUHVzaCBudWxsIGVsZW1lbnQgKGNhc3RlZCB0byBnaXZlbiB0eXBlKQo7OzsgQnkgdGhlIFRWTSB0eXBlIGBOdWxsYCBGdW5DIHJlcHJlc2VudHMgYWJzZW5jZSBvZiBhIHZhbHVlIG9mIHNvbWUgYXRvbWljIHR5cGUuCjs7OyBTbyBgbnVsbGAgY2FuIGFjdHVhbGx5IGhhdmUgYW55IGF0b21pYyB0eXBlLgpmb3JhbGwgWCAtPiBYIG51bGwoKSBhc20gIlBVU0hOVUxMIjsKCjs7OyBNb3ZlcyBhIHZhcmlhYmxlIFt4XSB0byB0aGUgdG9wIG9mIHRoZSBzdGFjawpmb3JhbGwgWCAtPiAoWCwgKCkpIH5pbXB1cmVfdG91Y2goWCB4KSBpbXB1cmUgYXNtICJOT1AiOwoKCgo7OzsgUmV0dXJucyB0aGUgY3VycmVudCBVbml4IHRpbWUgYXMgYW4gSW50ZWdlcgppbnQgbm93KCkgYXNtICJOT1ciOwoKOzs7IFJldHVybnMgdGhlIGludGVybmFsIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbnQgc21hcnQgY29udHJhY3QgYXMgYSBTbGljZSB3aXRoIGEgYE1zZ0FkZHJlc3NJbnRgLgo7OzsgSWYgbmVjZXNzYXJ5LCBpdCBjYW4gYmUgcGFyc2VkIGZ1cnRoZXIgdXNpbmcgcHJpbWl0aXZlcyBzdWNoIGFzIFtwYXJzZV9zdGRfYWRkcl0uCnNsaWNlIG15X2FkZHJlc3MoKSBhc20gIk1ZQUREUiI7Cgo7OzsgUmV0dXJucyB0aGUgYmFsYW5jZSBvZiB0aGUgc21hcnQgY29udHJhY3QgYXMgYSB0dXBsZSBjb25zaXN0aW5nIG9mIGFuIGludAo7OzsgKGJhbGFuY2UgaW4gbmFub3RvbmNvaW5zKSBhbmQgYSBgY2VsbGAKOzs7IChhIGRpY3Rpb25hcnkgd2l0aCAzMi1iaXQga2V5cyByZXByZXNlbnRpbmcgdGhlIGJhbGFuY2Ugb2YgImV4dHJhIGN1cnJlbmNpZXMiKQo7OzsgYXQgdGhlIHN0YXJ0IG9mIENvbXB1dGF0aW9uIFBoYXNlLgo7OzsgTm90ZSB0aGF0IFJBVyBwcmltaXRpdmVzIHN1Y2ggYXMgW3NlbmRfcmF3X21lc3NhZ2VdIGRvIG5vdCB1cGRhdGUgdGhpcyBmaWVsZC4KW2ludCwgY2VsbF0gZ2V0X2JhbGFuY2UoKSBhc20gIkJBTEFOQ0UiOwoKOzs7IFJldHVybnMgdGhlIGxvZ2ljYWwgdGltZSBvZiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KaW50IGN1cl9sdCgpIGFzbSAiTFRJTUUiOwoKOzs7IFJldHVybnMgdGhlIHN0YXJ0aW5nIGxvZ2ljYWwgdGltZSBvZiB0aGUgY3VycmVudCBibG9jay4KaW50IGJsb2NrX2x0KCkgYXNtICJCTE9DS0xUIjsKCjs7OyBDb21wdXRlcyB0aGUgcmVwcmVzZW50YXRpb24gaGFzaCBvZiBhIGBjZWxsYCBbY10gYW5kIHJldHVybnMgaXQgYXMgYSAyNTYtYml0IHVuc2lnbmVkIGludGVnZXIgYHhgLgo7OzsgVXNlZnVsIGZvciBzaWduaW5nIGFuZCBjaGVja2luZyBzaWduYXR1cmVzIG9mIGFyYml0cmFyeSBlbnRpdGllcyByZXByZXNlbnRlZCBieSBhIHRyZWUgb2YgY2VsbHMuCmludCBjZWxsX2hhc2goY2VsbCBjKSBhc20gIkhBU0hDVSI7Cgo7OzsgQ29tcHV0ZXMgdGhlIGhhc2ggb2YgYSBgc2xpY2Ugc2AgYW5kIHJldHVybnMgaXQgYXMgYSAyNTYtYml0IHVuc2lnbmVkIGludGVnZXIgYHhgLgo7OzsgVGhlIHJlc3VsdCBpcyB0aGUgc2FtZSBhcyBpZiBhbiBvcmRpbmFyeSBjZWxsIGNvbnRhaW5pbmcgb25seSBkYXRhIGFuZCByZWZlcmVuY2VzIGZyb20gYHNgIGhhZCBiZWVuIGNyZWF0ZWQKOzs7IGFuZCBpdHMgaGFzaCBjb21wdXRlZCBieSBbY2VsbF9oYXNoXS4KaW50IHNsaWNlX2hhc2goc2xpY2UgcykgYXNtICJIQVNIU1UiOwoKOzs7IENvbXB1dGVzIHNoYTI1NiBvZiB0aGUgZGF0YSBiaXRzIG9mIGBzbGljZWAgW3NdLiBJZiB0aGUgYml0IGxlbmd0aCBvZiBgc2AgaXMgbm90IGRpdmlzaWJsZSBieSBlaWdodCwKOzs7IHRocm93cyBhIGNlbGwgdW5kZXJmbG93IGV4Y2VwdGlvbi4gVGhlIGhhc2ggdmFsdWUgaXMgcmV0dXJuZWQgYXMgYSAyNTYtYml0IHVuc2lnbmVkIGludGVnZXIgYHhgLgppbnQgc3RyaW5nX2hhc2goc2xpY2UgcykgYXNtICJTSEEyNTZVIjsKCnstCiAgIyBTaWduYXR1cmUgY2hlY2tzCi19Cgo7OzsgQ2hlY2tzIHRoZSBFZDI1NTE5LWBzaWduYXR1cmVgIG9mIGEgYGhhc2hgIChhIDI1Ni1iaXQgdW5zaWduZWQgaW50ZWdlciwgdXN1YWxseSBjb21wdXRlZCBhcyB0aGUgaGFzaCBvZiBzb21lIGRhdGEpCjs7OyB1c2luZyBbcHVibGljX2tleV0gKGFsc28gcmVwcmVzZW50ZWQgYnkgYSAyNTYtYml0IHVuc2lnbmVkIGludGVnZXIpLgo7OzsgVGhlIHNpZ25hdHVyZSBtdXN0IGNvbnRhaW4gYXQgbGVhc3QgNTEyIGRhdGEgYml0czsgb25seSB0aGUgZmlyc3QgNTEyIGJpdHMgYXJlIHVzZWQuCjs7OyBUaGUgcmVzdWx0IGlzIGAxYCBpZiB0aGUgc2lnbmF0dXJlIGlzIHZhbGlkLCBgMGAgb3RoZXJ3aXNlLgo7OzsgTm90ZSB0aGF0IGBDSEtTSUdOVWAgY3JlYXRlcyBhIDI1Ni1iaXQgc2xpY2Ugd2l0aCB0aGUgaGFzaCBhbmQgY2FsbHMgYENIS1NJR05TYC4KOzs7IFRoYXQgaXMsIGlmIFtoYXNoXSBpcyBjb21wdXRlZCBhcyB0aGUgaGFzaCBvZiBzb21lIGRhdGEsIHRoZXNlIGRhdGEgYXJlIGhhc2hlZCB0d2ljZSwKOzs7IHRoZSBzZWNvbmQgaGFzaGluZyBvY2N1cnJpbmcgaW5zaWRlIGBDSEtTSUdOU2AuCmludCBjaGVja19zaWduYXR1cmUoaW50IGhhc2gsIHNsaWNlIHNpZ25hdHVyZSwgaW50IHB1YmxpY19rZXkpIGFzbSAiQ0hLU0lHTlUiOwoKOzs7IENoZWNrcyB3aGV0aGVyIFtzaWduYXR1cmVdIGlzIGEgdmFsaWQgRWQyNTUxOS1zaWduYXR1cmUgb2YgdGhlIGRhdGEgcG9ydGlvbiBvZiBgc2xpY2UgZGF0YWAgdXNpbmcgYHB1YmxpY19rZXlgLAo7Ozsgc2ltaWxhcmx5IHRvIFtjaGVja19zaWduYXR1cmVdLgo7OzsgSWYgdGhlIGJpdCBsZW5ndGggb2YgW2RhdGFdIGlzIG5vdCBkaXZpc2libGUgYnkgZWlnaHQsIHRocm93cyBhIGNlbGwgdW5kZXJmbG93IGV4Y2VwdGlvbi4KOzs7IFRoZSB2ZXJpZmljYXRpb24gb2YgRWQyNTUxOSBzaWduYXR1cmVzIGlzIHRoZSBzdGFuZGFyZCBvbmUsCjs7OyB3aXRoIHNoYTI1NiB1c2VkIHRvIHJlZHVjZSBbZGF0YV0gdG8gdGhlIDI1Ni1iaXQgbnVtYmVyIHRoYXQgaXMgYWN0dWFsbHkgc2lnbmVkLgppbnQgY2hlY2tfZGF0YV9zaWduYXR1cmUoc2xpY2UgZGF0YSwgc2xpY2Ugc2lnbmF0dXJlLCBpbnQgcHVibGljX2tleSkgYXNtICJDSEtTSUdOUyI7Cgp7LS0tCiAgIyBDb21wdXRhdGlvbiBvZiBib2Mgc2l6ZQogIFRoZSBwcmltaXRpdmVzIGJlbG93IG1heSBiZSB1c2VmdWwgZm9yIGNvbXB1dGluZyBzdG9yYWdlIGZlZXMgb2YgdXNlci1wcm92aWRlZCBkYXRhLgotfQoKOzs7IFJldHVybnMgYCh4LCB5LCB6LCAtMSlgIG9yIGAobnVsbCwgbnVsbCwgbnVsbCwgMClgLgo7OzsgUmVjdXJzaXZlbHkgY29tcHV0ZXMgdGhlIGNvdW50IG9mIGRpc3RpbmN0IGNlbGxzIGB4YCwgZGF0YSBiaXRzIGB5YCwgYW5kIGNlbGwgcmVmZXJlbmNlcyBgemAKOzs7IGluIHRoZSBEQUcgcm9vdGVkIGF0IGBjZWxsYCBbY10sIGVmZmVjdGl2ZWx5IHJldHVybmluZyB0aGUgdG90YWwgc3RvcmFnZSB1c2VkIGJ5IHRoaXMgREFHIHRha2luZyBpbnRvIGFjY291bnQKOzs7IHRoZSBpZGVudGlmaWNhdGlvbiBvZiBlcXVhbCBjZWxscy4KOzs7IFRoZSB2YWx1ZXMgb2YgYHhgLCBgeWAsIGFuZCBgemAgYXJlIGNvbXB1dGVkIGJ5IGEgZGVwdGgtZmlyc3QgdHJhdmVyc2FsIG9mIHRoaXMgREFHLAo7Ozsgd2l0aCBhIGhhc2ggdGFibGUgb2YgdmlzaXRlZCBjZWxsIGhhc2hlcyB1c2VkIHRvIHByZXZlbnQgdmlzaXRzIG9mIGFscmVhZHktdmlzaXRlZCBjZWxscy4KOzs7IFRoZSB0b3RhbCBjb3VudCBvZiB2aXNpdGVkIGNlbGxzIGB4YCBjYW5ub3QgZXhjZWVkIG5vbi1uZWdhdGl2ZSBbbWF4X2NlbGxzXTsKOzs7IG90aGVyd2lzZSB0aGUgY29tcHV0YXRpb24gaXMgYWJvcnRlZCBiZWZvcmUgdmlzaXRpbmcgdGhlIGAobWF4X2NlbGxzICsgMSlgLXN0IGNlbGwgYW5kCjs7OyBhIHplcm8gZmxhZyBpcyByZXR1cm5lZCB0byBpbmRpY2F0ZSBmYWlsdXJlLiBJZiBbY10gaXMgYG51bGxgLCByZXR1cm5zIGB4ID0geSA9IHogPSAwYC4KKGludCwgaW50LCBpbnQpIGNvbXB1dGVfZGF0YV9zaXplKGNlbGwgYywgaW50IG1heF9jZWxscykgaW1wdXJlIGFzbSAiQ0RBVEFTSVpFIjsKCjs7OyBTaW1pbGFyIHRvIFtjb21wdXRlX2RhdGFfc2l6ZT9dLCBidXQgYWNjZXB0aW5nIGEgYHNsaWNlYCBbc10gaW5zdGVhZCBvZiBhIGBjZWxsYC4KOzs7IFRoZSByZXR1cm5lZCB2YWx1ZSBvZiBgeGAgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGNlbGwgdGhhdCBjb250YWlucyB0aGUgYHNsaWNlYCBbc10gaXRzZWxmOwo7OzsgaG93ZXZlciwgdGhlIGRhdGEgYml0cyBhbmQgdGhlIGNlbGwgcmVmZXJlbmNlcyBvZiBbc10gYXJlIGFjY291bnRlZCBmb3IgaW4gYHlgIGFuZCBgemAuCihpbnQsIGludCwgaW50KSBzbGljZV9jb21wdXRlX2RhdGFfc2l6ZShzbGljZSBzLCBpbnQgbWF4X2NlbGxzKSBpbXB1cmUgYXNtICJTREFUQVNJWkUiOwoKOzs7IEEgbm9uLXF1aWV0IHZlcnNpb24gb2YgW2NvbXB1dGVfZGF0YV9zaXplP10gdGhhdCB0aHJvd3MgYSBjZWxsIG92ZXJmbG93IGV4Y2VwdGlvbiAoYDhgKSBvbiBmYWlsdXJlLgooaW50LCBpbnQsIGludCwgaW50KSBjb21wdXRlX2RhdGFfc2l6ZT8oY2VsbCBjLCBpbnQgbWF4X2NlbGxzKSBhc20gIkNEQVRBU0laRVEgTlVMTFNXQVBJRk5PVDIgTlVMTFNXQVBJRk5PVCI7Cgo7OzsgQSBub24tcXVpZXQgdmVyc2lvbiBvZiBbc2xpY2VfY29tcHV0ZV9kYXRhX3NpemU/XSB0aGF0IHRocm93cyBhIGNlbGwgb3ZlcmZsb3cgZXhjZXB0aW9uICg4KSBvbiBmYWlsdXJlLgooaW50LCBpbnQsIGludCwgaW50KSBzbGljZV9jb21wdXRlX2RhdGFfc2l6ZT8oY2VsbCBjLCBpbnQgbWF4X2NlbGxzKSBhc20gIlNEQVRBU0laRVEgTlVMTFNXQVBJRk5PVDIgTlVMTFNXQVBJRk5PVCI7Cgo7OzsgVGhyb3dzIGFuIGV4Y2VwdGlvbiB3aXRoIGV4aXRfY29kZSBleGNubyBpZiBjb25kIGlzIG5vdCAwIChjb21tZW50ZWQgc2luY2UgaW1wbGVtZW50ZWQgaW4gY29tcGlsYXRvcikKOzsgKCkgdGhyb3dfaWYoaW50IGV4Y25vLCBpbnQgY29uZCkgaW1wdXJlIGFzbSAiVEhST1dBUkdJRiI7Cgp7LS0KICAjIERlYnVnIHByaW1pdGl2ZXMKICBPbmx5IHdvcmtzIGZvciBsb2NhbCBUVk0gZXhlY3V0aW9uIHdpdGggZGVidWcgbGV2ZWwgdmVyYm9zaXR5Ci19Cjs7OyBEdW1wcyB0aGUgc3RhY2sgKGF0IG1vc3QgdGhlIHRvcCAyNTUgdmFsdWVzKSBhbmQgc2hvd3MgdGhlIHRvdGFsIHN0YWNrIGRlcHRoLgooKSBkdW1wX3N0YWNrKCkgaW1wdXJlIGFzbSAiRFVNUFNUSyI7Cgp7LQogICMgUGVyc2lzdGVudCBzdG9yYWdlIHNhdmUgYW5kIGxvYWQKLX0KCjs7OyBSZXR1cm5zIHRoZSBwZXJzaXN0ZW50IGNvbnRyYWN0IHN0b3JhZ2UgY2VsbC4gSXQgY2FuIGJlIHBhcnNlZCBvciBtb2RpZmllZCB3aXRoIHNsaWNlIGFuZCBidWlsZGVyIHByaW1pdGl2ZXMgbGF0ZXIuCmNlbGwgZ2V0X2RhdGEoKSBhc20gImM0IFBVU0giOwoKOzs7IFNldHMgYGNlbGxgIFtjXSBhcyBwZXJzaXN0ZW50IGNvbnRyYWN0IGRhdGEuIFlvdSBjYW4gdXBkYXRlIHBlcnNpc3RlbnQgY29udHJhY3Qgc3RvcmFnZSB3aXRoIHRoaXMgcHJpbWl0aXZlLgooKSBzZXRfZGF0YShjZWxsIGMpIGltcHVyZSBhc20gImM0IFBPUCI7Cgp7LQogICMgQ29udGludWF0aW9uIHByaW1pdGl2ZXMKLX0KOzs7IFVzdWFsbHkgYGMzYCBoYXMgYSBjb250aW51YXRpb24gaW5pdGlhbGl6ZWQgYnkgdGhlIHdob2xlIGNvZGUgb2YgdGhlIGNvbnRyYWN0LiBJdCBpcyB1c2VkIGZvciBmdW5jdGlvbiBjYWxscy4KOzs7IFRoZSBwcmltaXRpdmUgcmV0dXJucyB0aGUgY3VycmVudCB2YWx1ZSBvZiBgYzNgLgpjb250IGdldF9jMygpIGltcHVyZSBhc20gImMzIFBVU0giOwoKOzs7IFVwZGF0ZXMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGMzYC4gVXN1YWxseSwgaXQgaXMgdXNlZCBmb3IgdXBkYXRpbmcgc21hcnQgY29udHJhY3QgY29kZSBpbiBydW4tdGltZS4KOzs7IE5vdGUgdGhhdCBhZnRlciBleGVjdXRpb24gb2YgdGhpcyBwcmltaXRpdmUgdGhlIGN1cnJlbnQgY29kZQo7OzsgKGFuZCB0aGUgc3RhY2sgb2YgcmVjdXJzaXZlIGZ1bmN0aW9uIGNhbGxzKSB3b24ndCBjaGFuZ2UsCjs7OyBidXQgYW55IG90aGVyIGZ1bmN0aW9uIGNhbGwgd2lsbCB1c2UgYSBmdW5jdGlvbiBmcm9tIHRoZSBuZXcgY29kZS4KKCkgc2V0X2MzKGNvbnQgYykgaW1wdXJlIGFzbSAiYzMgUE9QIjsKCjs7OyBUcmFuc2Zvcm1zIGEgYHNsaWNlYCBbc10gaW50byBhIHNpbXBsZSBvcmRpbmFyeSBjb250aW51YXRpb24gYGNgLCB3aXRoIGBjLmNvZGUgPSBzYCBhbmQgYW4gZW1wdHkgc3RhY2sgYW5kIHNhdmVsaXN0Lgpjb250IGJsZXNzKHNsaWNlIHMpIGltcHVyZSBhc20gIkJMRVNTIjsKCnstLS0KICAjIEdhcyByZWxhdGVkIHByaW1pdGl2ZXMKLX0KCjs7OyBTZXRzIGN1cnJlbnQgZ2FzIGxpbWl0IGBnbGAgdG8gaXRzIG1heGltYWwgYWxsb3dlZCB2YWx1ZSBgZ21gLCBhbmQgcmVzZXRzIHRoZSBnYXMgY3JlZGl0IGBnY2AgdG8gemVybywKOzs7IGRlY3JlYXNpbmcgdGhlIHZhbHVlIG9mIGBncmAgYnkgYGdjYCBpbiB0aGUgcHJvY2Vzcy4KOzs7IEluIG90aGVyIHdvcmRzLCB0aGUgY3VycmVudCBzbWFydCBjb250cmFjdCBhZ3JlZXMgdG8gYnV5IHNvbWUgZ2FzIHRvIGZpbmlzaCB0aGUgY3VycmVudCB0cmFuc2FjdGlvbi4KOzs7IFRoaXMgYWN0aW9uIGlzIHJlcXVpcmVkIHRvIHByb2Nlc3MgZXh0ZXJuYWwgbWVzc2FnZXMsIHdoaWNoIGJyaW5nIG5vIHZhbHVlIChoZW5jZSBubyBnYXMpIHdpdGggdGhlbXNlbHZlcy4KOzs7Cjs7OyBGb3IgbW9yZSBkZXRhaWxzIGNoZWNrIFthY2NlcHRfbWVzc2FnZSBlZmZlY3RzXShodHRwczovL3Rvbi5vcmcvZG9jcy8jL3NtYXJ0LWNvbnRyYWN0cy9hY2NlcHQpLgooKSBhY2NlcHRfbWVzc2FnZSgpIGltcHVyZSBhc20gIkFDQ0VQVCI7Cgo7OzsgU2V0cyBjdXJyZW50IGdhcyBsaW1pdCBgZ2xgIHRvIHRoZSBtaW5pbXVtIG9mIGxpbWl0IGFuZCBgZ21gLCBhbmQgcmVzZXRzIHRoZSBnYXMgY3JlZGl0IGBnY2AgdG8gemVyby4KOzs7IElmIHRoZSBnYXMgY29uc3VtZWQgc28gZmFyIChpbmNsdWRpbmcgdGhlIHByZXNlbnQgaW5zdHJ1Y3Rpb24pIGV4Y2VlZHMgdGhlIHJlc3VsdGluZyB2YWx1ZSBvZiBgZ2xgLAo7OzsgYW4gKHVuaGFuZGxlZCkgb3V0IG9mIGdhcyBleGNlcHRpb24gaXMgdGhyb3duIGJlZm9yZSBzZXR0aW5nIG5ldyBnYXMgbGltaXRzLgo7OzsgTm90aWNlIHRoYXQgW3NldF9nYXNfbGltaXRdIHdpdGggYW4gYXJndW1lbnQgYGxpbWl0ICAyXjYzICAxYCBpcyBlcXVpdmFsZW50IHRvIFthY2NlcHRfbWVzc2FnZV0uCigpIHNldF9nYXNfbGltaXQoaW50IGxpbWl0KSBpbXB1cmUgYXNtICJTRVRHQVNMSU1JVCI7Cgo7OzsgQ29tbWl0cyB0aGUgY3VycmVudCBzdGF0ZSBvZiByZWdpc3RlcnMgYGM0YCAocGVyc2lzdGVudCBkYXRhKSBhbmQgYGM1YCAoYWN0aW9ucykKOzs7IHNvIHRoYXQgdGhlIGN1cnJlbnQgZXhlY3V0aW9uIGlzIGNvbnNpZGVyZWQgc3VjY2Vzc2Z1bCB3aXRoIHRoZSBzYXZlZCB2YWx1ZXMgZXZlbiBpZiBhbiBleGNlcHRpb24KOzs7IGluIENvbXB1dGF0aW9uIFBoYXNlIGlzIHRocm93biBsYXRlci4KKCkgY29tbWl0KCkgaW1wdXJlIGFzbSAiQ09NTUlUIjsKCjs7OyBOb3QgaW1wbGVtZW50ZWQKOzsoKSBidXlfZ2FzKGludCBncmFtKSBpbXB1cmUgYXNtICJCVVlHQVMiOwoKOzs7IENvbXB1dGVzIHRoZSBhbW91bnQgb2YgZ2FzIHRoYXQgY2FuIGJlIGJvdWdodCBmb3IgYGFtb3VudGAgbmFub1RPTnMsCjs7OyBhbmQgc2V0cyBgZ2xgIGFjY29yZGluZ2x5IGluIHRoZSBzYW1lIHdheSBhcyBbc2V0X2dhc19saW1pdF0uCigpIGJ1eV9nYXMoaW50IGFtb3VudCkgaW1wdXJlIGFzbSAiQlVZR0FTIjsKCjs7OyBDb21wdXRlcyB0aGUgbWluaW11bSBvZiB0d28gaW50ZWdlcnMgW3hdIGFuZCBbeV0uCmludCBtaW4oaW50IHgsIGludCB5KSBhc20gIk1JTiI7Cgo7OzsgQ29tcHV0ZXMgdGhlIG1heGltdW0gb2YgdHdvIGludGVnZXJzIFt4XSBhbmQgW3ldLgppbnQgbWF4KGludCB4LCBpbnQgeSkgYXNtICJNQVgiOwoKOzs7IFNvcnRzIHR3byBpbnRlZ2Vycy4KKGludCwgaW50KSBtaW5tYXgoaW50IHgsIGludCB5KSBhc20gIk1JTk1BWCI7Cgo7OzsgQ29tcHV0ZXMgdGhlIGFic29sdXRlIHZhbHVlIG9mIGFuIGludGVnZXIgW3hdLgppbnQgYWJzKGludCB4KSBhc20gIkFCUyI7Cgp7LQogICMgU2xpY2UgcHJpbWl0aXZlcwoKICBJdCBpcyBzYWlkIHRoYXQgYSBwcmltaXRpdmUgX2xvYWRzXyBzb21lIGRhdGEsCiAgaWYgaXQgcmV0dXJucyB0aGUgZGF0YSBhbmQgdGhlIHJlbWFpbmRlciBvZiB0aGUgc2xpY2UKICAoc28gaXQgY2FuIGFsc28gYmUgdXNlZCBhcyBbbW9kaWZ5aW5nIG1ldGhvZF0oaHR0cHM6Ly90b24ub3JnL2RvY3MvIy9mdW5jL3N0YXRlbWVudHM/aWQ9bW9kaWZ5aW5nLW1ldGhvZHMpKS4KCiAgSXQgaXMgc2FpZCB0aGF0IGEgcHJpbWl0aXZlIF9wcmVsb2Fkc18gc29tZSBkYXRhLCBpZiBpdCByZXR1cm5zIG9ubHkgdGhlIGRhdGEKICAoaXQgY2FuIGJlIHVzZWQgYXMgW25vbi1tb2RpZnlpbmcgbWV0aG9kXShodHRwczovL3Rvbi5vcmcvZG9jcy8jL2Z1bmMvc3RhdGVtZW50cz9pZD1ub24tbW9kaWZ5aW5nLW1ldGhvZHMpKS4KCiAgVW5sZXNzIG90aGVyd2lzZSBzdGF0ZWQsIGxvYWRpbmcgYW5kIHByZWxvYWRpbmcgcHJpbWl0aXZlcyByZWFkIHRoZSBkYXRhIGZyb20gYSBwcmVmaXggb2YgdGhlIHNsaWNlLgotfQoKCjs7OyBDb252ZXJ0cyBhIGBjZWxsYCBbY10gaW50byBhIGBzbGljZWAuIE5vdGljZSB0aGF0IFtjXSBtdXN0IGJlIGVpdGhlciBhbiBvcmRpbmFyeSBjZWxsLAo7Ozsgb3IgYW4gZXhvdGljIGNlbGwgKHNlZSBbVFZNLnBkZl0oaHR0cHM6Ly90b24tYmxvY2tjaGFpbi5naXRodWIuaW8vZG9jcy90dm0ucGRmKSwgMy4xLjIpCjs7OyB3aGljaCBpcyBhdXRvbWF0aWNhbGx5IGxvYWRlZCB0byB5aWVsZCBhbiBvcmRpbmFyeSBjZWxsIGBjJ2AsIGNvbnZlcnRlZCBpbnRvIGEgYHNsaWNlYCBhZnRlcndhcmRzLgpzbGljZSBiZWdpbl9wYXJzZShjZWxsIGMpIGFzbSAiQ1RPUyI7Cgo7OzsgQ2hlY2tzIGlmIFtzXSBpcyBlbXB0eS4gSWYgbm90LCB0aHJvd3MgYW4gZXhjZXB0aW9uLgooKSBlbmRfcGFyc2Uoc2xpY2UgcykgaW1wdXJlIGFzbSAiRU5EUyI7Cgo7OzsgTG9hZHMgdGhlIGZpcnN0IHJlZmVyZW5jZSBmcm9tIHRoZSBzbGljZS4KKHNsaWNlLCBjZWxsKSBsb2FkX3JlZihzbGljZSBzKSBhc20oIC0+IDEgMCkgIkxEUkVGIjsKCjs7OyBQcmVsb2FkcyB0aGUgZmlyc3QgcmVmZXJlbmNlIGZyb20gdGhlIHNsaWNlLgpjZWxsIHByZWxvYWRfcmVmKHNsaWNlIHMpIGFzbSAiUExEUkVGIjsKCiAgey0gRnVuY3Rpb25zIGJlbG93IGFyZSBjb21tZW50ZWQgYmVjYXVzZSBhcmUgaW1wbGVtZW50ZWQgb24gY29tcGlsYXRvciBsZXZlbCBmb3Igb3B0aW1pc2F0aW9uIC19Cgo7OzsgTG9hZHMgYSBzaWduZWQgW2xlbl0tYml0IGludGVnZXIgZnJvbSBhIHNsaWNlIFtzXS4KOzsgKHNsaWNlLCBpbnQpIH5sb2FkX2ludChzbGljZSBzLCBpbnQgbGVuKSBhc20ocyBsZW4gLT4gMSAwKSAiTERJWCI7Cgo7OzsgTG9hZHMgYW4gdW5zaWduZWQgW2xlbl0tYml0IGludGVnZXIgZnJvbSBhIHNsaWNlIFtzXS4KOzsgKHNsaWNlLCBpbnQpIH5sb2FkX3VpbnQoc2xpY2UgcywgaW50IGxlbikgYXNtKCAtPiAxIDApICJMRFVYIjsKCjs7OyBQcmVsb2FkcyBhIHNpZ25lZCBbbGVuXS1iaXQgaW50ZWdlciBmcm9tIGEgc2xpY2UgW3NdLgo7OyBpbnQgcHJlbG9hZF9pbnQoc2xpY2UgcywgaW50IGxlbikgYXNtICJQTERJWCI7Cgo7OzsgUHJlbG9hZHMgYW4gdW5zaWduZWQgW2xlbl0tYml0IGludGVnZXIgZnJvbSBhIHNsaWNlIFtzXS4KOzsgaW50IHByZWxvYWRfdWludChzbGljZSBzLCBpbnQgbGVuKSBhc20gIlBMRFVYIjsKCjs7OyBMb2FkcyB0aGUgZmlyc3QgYDAgIGxlbiAgMTAyM2AgYml0cyBmcm9tIHNsaWNlIFtzXSBpbnRvIGEgc2VwYXJhdGUgYHNsaWNlIHMnJ2AuCjs7IChzbGljZSwgc2xpY2UpIGxvYWRfYml0cyhzbGljZSBzLCBpbnQgbGVuKSBhc20ocyBsZW4gLT4gMSAwKSAiTERTTElDRVgiOwoKOzs7IFByZWxvYWRzIHRoZSBmaXJzdCBgMCAgbGVuICAxMDIzYCBiaXRzIGZyb20gc2xpY2UgW3NdIGludG8gYSBzZXBhcmF0ZSBgc2xpY2UgcycnYC4KOzsgc2xpY2UgcHJlbG9hZF9iaXRzKHNsaWNlIHMsIGludCBsZW4pIGFzbSAiUExEU0xJQ0VYIjsKCjs7OyBMb2FkcyBzZXJpYWxpemVkIGFtb3VudCBvZiBUb25Db2lucyAoYW55IHVuc2lnbmVkIGludGVnZXIgdXAgdG8gYDJeMTI4IC0gMWApLgooc2xpY2UsIGludCkgbG9hZF9ncmFtcyhzbGljZSBzKSBhc20oIC0+IDEgMCkgIkxER1JBTVMiOwooc2xpY2UsIGludCkgbG9hZF9jb2lucyhzbGljZSBzKSBhc20oIC0+IDEgMCkgIkxER1JBTVMiOwoKOzs7IFJldHVybnMgYWxsIGJ1dCB0aGUgZmlyc3QgYDAgIGxlbiAgMTAyM2AgYml0cyBvZiBgc2xpY2VgIFtzXS4Kc2xpY2Ugc2tpcF9iaXRzKHNsaWNlIHMsIGludCBsZW4pIGFzbSAiU0RTS0lQRklSU1QiOwooc2xpY2UsICgpKSB+c2tpcF9iaXRzKHNsaWNlIHMsIGludCBsZW4pIGFzbSAiU0RTS0lQRklSU1QiOwoKOzs7IFJldHVybnMgdGhlIGZpcnN0IGAwICBsZW4gIDEwMjNgIGJpdHMgb2YgYHNsaWNlYCBbc10uCnNsaWNlIGZpcnN0X2JpdHMoc2xpY2UgcywgaW50IGxlbikgYXNtICJTRENVVEZJUlNUIjsKCjs7OyBSZXR1cm5zIGFsbCBidXQgdGhlIGxhc3QgYDAgIGxlbiAgMTAyM2AgYml0cyBvZiBgc2xpY2VgIFtzXS4Kc2xpY2Ugc2tpcF9sYXN0X2JpdHMoc2xpY2UgcywgaW50IGxlbikgYXNtICJTRFNLSVBMQVNUIjsKKHNsaWNlLCAoKSkgfnNraXBfbGFzdF9iaXRzKHNsaWNlIHMsIGludCBsZW4pIGFzbSAiU0RTS0lQTEFTVCI7Cgo7OzsgUmV0dXJucyB0aGUgbGFzdCBgMCAgbGVuICAxMDIzYCBiaXRzIG9mIGBzbGljZWAgW3NdLgpzbGljZSBzbGljZV9sYXN0KHNsaWNlIHMsIGludCBsZW4pIGFzbSAiU0RDVVRMQVNUIjsKCjs7OyBMb2FkcyBhIGRpY3Rpb25hcnkgYERgIChIYXNoTWFwRSkgZnJvbSBgc2xpY2VgIFtzXS4KOzs7IChyZXR1cm5zIGBudWxsYCBpZiBgbm90aGluZ2AgY29uc3RydWN0b3IgaXMgdXNlZCkuCihzbGljZSwgY2VsbCkgbG9hZF9kaWN0KHNsaWNlIHMpIGFzbSggLT4gMSAwKSAiTERESUNUIjsKCjs7OyBQcmVsb2FkcyBhIGRpY3Rpb25hcnkgYERgIGZyb20gYHNsaWNlYCBbc10uCmNlbGwgcHJlbG9hZF9kaWN0KHNsaWNlIHMpIGFzbSAiUExERElDVCI7Cgo7OzsgTG9hZHMgYSBkaWN0aW9uYXJ5IGFzIFtsb2FkX2RpY3RdLCBidXQgcmV0dXJucyBvbmx5IHRoZSByZW1haW5kZXIgb2YgdGhlIHNsaWNlLgpzbGljZSBza2lwX2RpY3Qoc2xpY2UgcykgYXNtICJTS0lQRElDVCI7Cgo7OzsgTG9hZHMgKE1heWJlIF5DZWxsKSBmcm9tIGBzbGljZWAgW3NdLgo7OzsgSW4gb3RoZXIgd29yZHMgbG9hZHMgMSBiaXQgYW5kIGlmIGl0IGlzIHRydWUKOzs7IGxvYWRzIGZpcnN0IHJlZiBhbmQgcmV0dXJuIGl0IHdpdGggc2xpY2UgcmVtYWluZGVyCjs7OyBvdGhlcndpc2UgcmV0dXJucyBgbnVsbGAgYW5kIHNsaWNlIHJlbWFpbmRlcgooc2xpY2UsIGNlbGwpIGxvYWRfbWF5YmVfcmVmKHNsaWNlIHMpIGFzbSggLT4gMSAwKSAiTERPUFRSRUYiOwoKOzs7IFByZWxvYWRzIChNYXliZSBeQ2VsbCkgZnJvbSBgc2xpY2VgIFtzXS4KY2VsbCBwcmVsb2FkX21heWJlX3JlZihzbGljZSBzKSBhc20gIlBMRE9QVFJFRiI7CgoKOzs7IFJldHVybnMgdGhlIGRlcHRoIG9mIGBjZWxsYCBbY10uCjs7OyBJZiBbY10gaGFzIG5vIHJlZmVyZW5jZXMsIHRoZW4gcmV0dXJuIGAwYDsKOzs7IG90aGVyd2lzZSB0aGUgcmV0dXJuZWQgdmFsdWUgaXMgb25lIHBsdXMgdGhlIG1heGltdW0gb2YgZGVwdGhzIG9mIGNlbGxzIHJlZmVycmVkIHRvIGZyb20gW2NdLgo7OzsgSWYgW2NdIGlzIGEgYG51bGxgIGluc3RlYWQgb2YgYSBjZWxsLCByZXR1cm5zIHplcm8uCmludCBjZWxsX2RlcHRoKGNlbGwgYykgYXNtICJDREVQVEgiOwoKCnstCiAgIyBTbGljZSBzaXplIHByaW1pdGl2ZXMKLX0KCjs7OyBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcmVmZXJlbmNlcyBpbiBgc2xpY2VgIFtzXS4KaW50IHNsaWNlX3JlZnMoc2xpY2UgcykgYXNtICJTUkVGUyI7Cgo7OzsgUmV0dXJucyB0aGUgbnVtYmVyIG9mIGRhdGEgYml0cyBpbiBgc2xpY2VgIFtzXS4KaW50IHNsaWNlX2JpdHMoc2xpY2UgcykgYXNtICJTQklUUyI7Cgo7OzsgUmV0dXJucyBib3RoIHRoZSBudW1iZXIgb2YgZGF0YSBiaXRzIGFuZCB0aGUgbnVtYmVyIG9mIHJlZmVyZW5jZXMgaW4gYHNsaWNlYCBbc10uCihpbnQsIGludCkgc2xpY2VfYml0c19yZWZzKHNsaWNlIHMpIGFzbSAiU0JJVFJFRlMiOwoKOzs7IENoZWNrcyB3aGV0aGVyIGEgYHNsaWNlYCBbc10gaXMgZW1wdHkgKGkuZS4sIGNvbnRhaW5zIG5vIGJpdHMgb2YgZGF0YSBhbmQgbm8gY2VsbCByZWZlcmVuY2VzKS4KaW50IHNsaWNlX2VtcHR5PyhzbGljZSBzKSBhc20gIlNFTVBUWSI7Cgo7OzsgQ2hlY2tzIHdoZXRoZXIgYHNsaWNlYCBbc10gaGFzIG5vIGJpdHMgb2YgZGF0YS4KaW50IHNsaWNlX2RhdGFfZW1wdHk/KHNsaWNlIHMpIGFzbSAiU0RFTVBUWSI7Cgo7OzsgQ2hlY2tzIHdoZXRoZXIgYHNsaWNlYCBbc10gaGFzIG5vIHJlZmVyZW5jZXMuCmludCBzbGljZV9yZWZzX2VtcHR5PyhzbGljZSBzKSBhc20gIlNSRU1QVFkiOwoKOzs7IFJldHVybnMgdGhlIGRlcHRoIG9mIGBzbGljZWAgW3NdLgo7OzsgSWYgW3NdIGhhcyBubyByZWZlcmVuY2VzLCB0aGVuIHJldHVybnMgYDBgOwo7Ozsgb3RoZXJ3aXNlIHRoZSByZXR1cm5lZCB2YWx1ZSBpcyBvbmUgcGx1cyB0aGUgbWF4aW11bSBvZiBkZXB0aHMgb2YgY2VsbHMgcmVmZXJyZWQgdG8gZnJvbSBbc10uCmludCBzbGljZV9kZXB0aChzbGljZSBzKSBhc20gIlNERVBUSCI7Cgp7LQogICMgQnVpbGRlciBzaXplIHByaW1pdGl2ZXMKLX0KCjs7OyBSZXR1cm5zIHRoZSBudW1iZXIgb2YgY2VsbCByZWZlcmVuY2VzIGFscmVhZHkgc3RvcmVkIGluIGBidWlsZGVyYCBbYl0KaW50IGJ1aWxkZXJfcmVmcyhidWlsZGVyIGIpIGFzbSAiQlJFRlMiOwoKOzs7IFJldHVybnMgdGhlIG51bWJlciBvZiBkYXRhIGJpdHMgYWxyZWFkeSBzdG9yZWQgaW4gYGJ1aWxkZXJgIFtiXS4KaW50IGJ1aWxkZXJfYml0cyhidWlsZGVyIGIpIGFzbSAiQkJJVFMiOwoKOzs7IFJldHVybnMgdGhlIGRlcHRoIG9mIGBidWlsZGVyYCBbYl0uCjs7OyBJZiBubyBjZWxsIHJlZmVyZW5jZXMgYXJlIHN0b3JlZCBpbiBbYl0sIHRoZW4gcmV0dXJucyAwOwo7Ozsgb3RoZXJ3aXNlIHRoZSByZXR1cm5lZCB2YWx1ZSBpcyBvbmUgcGx1cyB0aGUgbWF4aW11bSBvZiBkZXB0aHMgb2YgY2VsbHMgcmVmZXJyZWQgdG8gZnJvbSBbYl0uCmludCBidWlsZGVyX2RlcHRoKGJ1aWxkZXIgYikgYXNtICJCREVQVEgiOwoKey0KICAjIEJ1aWxkZXIgcHJpbWl0aXZlcwogIEl0IGlzIHNhaWQgdGhhdCBhIHByaW1pdGl2ZSBfc3RvcmVzXyBhIHZhbHVlIGB4YCBpbnRvIGEgYnVpbGRlciBgYmAKICBpZiBpdCByZXR1cm5zIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgYnVpbGRlciBgYidgIHdpdGggdGhlIHZhbHVlIGB4YCBzdG9yZWQgYXQgdGhlIGVuZCBvZiBpdC4KICBJdCBjYW4gYmUgdXNlZCBhcyBbbm9uLW1vZGlmeWluZyBtZXRob2RdKGh0dHBzOi8vdG9uLm9yZy9kb2NzLyMvZnVuYy9zdGF0ZW1lbnRzP2lkPW5vbi1tb2RpZnlpbmctbWV0aG9kcykuCgogIEFsbCB0aGUgcHJpbWl0aXZlcyBiZWxvdyBmaXJzdCBjaGVjayB3aGV0aGVyIHRoZXJlIGlzIGVub3VnaCBzcGFjZSBpbiB0aGUgYGJ1aWxkZXJgLAogIGFuZCBvbmx5IHRoZW4gY2hlY2sgdGhlIHJhbmdlIG9mIHRoZSB2YWx1ZSBiZWluZyBzZXJpYWxpemVkLgotfQoKOzs7IENyZWF0ZXMgYSBuZXcgZW1wdHkgYGJ1aWxkZXJgLgpidWlsZGVyIGJlZ2luX2NlbGwoKSBhc20gIk5FV0MiOwoKOzs7IENvbnZlcnRzIGEgYGJ1aWxkZXJgIGludG8gYW4gb3JkaW5hcnkgYGNlbGxgLgpjZWxsIGVuZF9jZWxsKGJ1aWxkZXIgYikgYXNtICJFTkRDIjsKCjs7OyBTdG9yZXMgYSByZWZlcmVuY2UgdG8gYGNlbGxgIFtjXSBpbnRvIGBidWlsZGVyYCBbYl0uCmJ1aWxkZXIgc3RvcmVfcmVmKGJ1aWxkZXIgYiwgY2VsbCBjKSBhc20oYyBiKSAiU1RSRUYiOwoKOzs7IFN0b3JlcyBhbiB1bnNpZ25lZCBbbGVuXS1iaXQgaW50ZWdlciBgeGAgaW50byBgYmAgZm9yIGAwICBsZW4gIDI1NmAuCjs7IGJ1aWxkZXIgc3RvcmVfdWludChidWlsZGVyIGIsIGludCB4LCBpbnQgbGVuKSBhc20oeCBiIGxlbikgIlNUVVgiOwoKOzs7IFN0b3JlcyBhIHNpZ25lZCBbbGVuXS1iaXQgaW50ZWdlciBgeGAgaW50byBgYmAgZm9yYCAwICBsZW4gIDI1N2AuCjs7IGJ1aWxkZXIgc3RvcmVfaW50KGJ1aWxkZXIgYiwgaW50IHgsIGludCBsZW4pIGFzbSh4IGIgbGVuKSAiU1RJWCI7CgoKOzs7IFN0b3JlcyBgc2xpY2VgIFtzXSBpbnRvIGBidWlsZGVyYCBbYl0KYnVpbGRlciBzdG9yZV9zbGljZShidWlsZGVyIGIsIHNsaWNlIHMpIGFzbSAiU1RTTElDRVIiOwoKOzs7IFN0b3JlcyAoc2VyaWFsaXplcykgYW4gaW50ZWdlciBbeF0gaW4gdGhlIHJhbmdlIGAwLi4yXjEyOCAgMWAgaW50byBgYnVpbGRlcmAgW2JdLgo7OzsgVGhlIHNlcmlhbGl6YXRpb24gb2YgW3hdIGNvbnNpc3RzIG9mIGEgNC1iaXQgdW5zaWduZWQgYmlnLWVuZGlhbiBpbnRlZ2VyIGBsYCwKOzs7IHdoaWNoIGlzIHRoZSBzbWFsbGVzdCBpbnRlZ2VyIGBsICAwYCwgc3VjaCB0aGF0IGB4IDwgMl44bGAsCjs7OyBmb2xsb3dlZCBieSBhbiBgOGxgLWJpdCB1bnNpZ25lZCBiaWctZW5kaWFuIHJlcHJlc2VudGF0aW9uIG9mIFt4XS4KOzs7IElmIFt4XSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHN1cHBvcnRlZCByYW5nZSwgYSByYW5nZSBjaGVjayBleGNlcHRpb24gaXMgdGhyb3duLgo7OzsKOzs7IFN0b3JlIGFtb3VudHMgb2YgVG9uQ29pbnMgdG8gdGhlIGJ1aWxkZXIgYXMgVmFyVUludGVnZXIgMTYKYnVpbGRlciBzdG9yZV9ncmFtcyhidWlsZGVyIGIsIGludCB4KSBhc20gIlNUR1JBTVMiOwpidWlsZGVyIHN0b3JlX2NvaW5zKGJ1aWxkZXIgYiwgaW50IHgpIGFzbSAiU1RHUkFNUyI7Cgo7OzsgU3RvcmVzIGRpY3Rpb25hcnkgYERgIHJlcHJlc2VudGVkIGJ5IGBjZWxsYCBbY10gb3IgYG51bGxgIGludG8gYGJ1aWxkZXJgIFtiXS4KOzs7IEluIG90aGVyIHdvcmRzLCBzdG9yZXMgYSBgMWAtYml0IGFuZCBhIHJlZmVyZW5jZSB0byBbY10gaWYgW2NdIGlzIG5vdCBgbnVsbGAgYW5kIGAwYC1iaXQgb3RoZXJ3aXNlLgpidWlsZGVyIHN0b3JlX2RpY3QoYnVpbGRlciBiLCBjZWxsIGMpIGFzbShjIGIpICJTVERJQ1QiOwoKOzs7IFN0b3JlcyAoTWF5YmUgXkNlbGwpIHRvIGJ1aWxkZXI6Cjs7OyBpZiBjZWxsIGlzIG51bGwgc3RvcmUgMSB6ZXJvIGJpdAo7Ozsgb3RoZXJ3aXNlIHN0b3JlIDEgdHJ1ZSBiaXQgYW5kIHJlZiB0byBjZWxsCmJ1aWxkZXIgc3RvcmVfbWF5YmVfcmVmKGJ1aWxkZXIgYiwgY2VsbCBjKSBhc20oYyBiKSAiU1RPUFRSRUYiOwoKCnstCiAgIyBBZGRyZXNzIG1hbmlwdWxhdGlvbiBwcmltaXRpdmVzCiAgVGhlIGFkZHJlc3MgbWFuaXB1bGF0aW9uIHByaW1pdGl2ZXMgbGlzdGVkIGJlbG93IHNlcmlhbGl6ZSBhbmQgZGVzZXJpYWxpemUgdmFsdWVzIGFjY29yZGluZyB0byB0aGUgZm9sbG93aW5nIFRMLUIgc2NoZW1lOgogIGBgYFRMLUIKICBhZGRyX25vbmUkMDAgPSBNc2dBZGRyZXNzRXh0OwogIGFkZHJfZXh0ZXJuJDAxIGxlbjooIyMgOCkgZXh0ZXJuYWxfYWRkcmVzczooYml0cyBsZW4pCiAgICAgICAgICAgICAgID0gTXNnQWRkcmVzc0V4dDsKICBhbnljYXN0X2luZm8kXyBkZXB0aDooIzw9IDMwKSB7IGRlcHRoID49IDEgfQogICAgcmV3cml0ZV9wZng6KGJpdHMgZGVwdGgpID0gQW55Y2FzdDsKICBhZGRyX3N0ZCQxMCBhbnljYXN0OihNYXliZSBBbnljYXN0KQogICAgd29ya2NoYWluX2lkOmludDggYWRkcmVzczpiaXRzMjU2ID0gTXNnQWRkcmVzc0ludDsKICBhZGRyX3ZhciQxMSBhbnljYXN0OihNYXliZSBBbnljYXN0KSBhZGRyX2xlbjooIyMgOSkKICAgIHdvcmtjaGFpbl9pZDppbnQzMiBhZGRyZXNzOihiaXRzIGFkZHJfbGVuKSA9IE1zZ0FkZHJlc3NJbnQ7CiAgXyBfOk1zZ0FkZHJlc3NJbnQgPSBNc2dBZGRyZXNzOwogIF8gXzpNc2dBZGRyZXNzRXh0ID0gTXNnQWRkcmVzczsKCiAgaW50X21zZ19pbmZvJDAgaWhyX2Rpc2FibGVkOkJvb2wgYm91bmNlOkJvb2wgYm91bmNlZDpCb29sCiAgICBzcmM6TXNnQWRkcmVzcyBkZXN0Ok1zZ0FkZHJlc3NJbnQKICAgIHZhbHVlOkN1cnJlbmN5Q29sbGVjdGlvbiBpaHJfZmVlOkdyYW1zIGZ3ZF9mZWU6R3JhbXMKICAgIGNyZWF0ZWRfbHQ6dWludDY0IGNyZWF0ZWRfYXQ6dWludDMyID0gQ29tbW9uTXNnSW5mb1JlbGF4ZWQ7CiAgZXh0X291dF9tc2dfaW5mbyQxMSBzcmM6TXNnQWRkcmVzcyBkZXN0Ok1zZ0FkZHJlc3NFeHQKICAgIGNyZWF0ZWRfbHQ6dWludDY0IGNyZWF0ZWRfYXQ6dWludDMyID0gQ29tbW9uTXNnSW5mb1JlbGF4ZWQ7CiAgYGBgCiAgQSBkZXNlcmlhbGl6ZWQgYE1zZ0FkZHJlc3NgIGlzIHJlcHJlc2VudGVkIGJ5IGEgdHVwbGUgYHRgIGFzIGZvbGxvd3M6CgogIC0gYGFkZHJfbm9uZWAgaXMgcmVwcmVzZW50ZWQgYnkgYHQgPSAoMClgLAogICAgaS5lLiwgYSB0dXBsZSBjb250YWluaW5nIGV4YWN0bHkgb25lIGludGVnZXIgZXF1YWwgdG8gemVyby4KICAtIGBhZGRyX2V4dGVybmAgaXMgcmVwcmVzZW50ZWQgYnkgYHQgPSAoMSwgcylgLAogICAgd2hlcmUgc2xpY2UgYHNgIGNvbnRhaW5zIHRoZSBmaWVsZCBgZXh0ZXJuYWxfYWRkcmVzc2AuIEluIG90aGVyIHdvcmRzLCBgCiAgICB0YCBpcyBhIHBhaXIgKGEgdHVwbGUgY29uc2lzdGluZyBvZiB0d28gZW50cmllcyksIGNvbnRhaW5pbmcgYW4gaW50ZWdlciBlcXVhbCB0byBvbmUgYW5kIHNsaWNlIGBzYC4KICAtIGBhZGRyX3N0ZGAgaXMgcmVwcmVzZW50ZWQgYnkgYHQgPSAoMiwgdSwgeCwgcylgLAogICAgd2hlcmUgYHVgIGlzIGVpdGhlciBhIGBudWxsYCAoaWYgYGFueWNhc3RgIGlzIGFic2VudCkgb3IgYSBzbGljZSBgcydgIGNvbnRhaW5pbmcgYHJld3JpdGVfcGZ4YCAoaWYgYW55Y2FzdCBpcyBwcmVzZW50KS4KICAgIE5leHQsIGludGVnZXIgYHhgIGlzIHRoZSBgd29ya2NoYWluX2lkYCwgYW5kIHNsaWNlIGBzYCBjb250YWlucyB0aGUgYWRkcmVzcy4KICAtIGBhZGRyX3ZhcmAgaXMgcmVwcmVzZW50ZWQgYnkgYHQgPSAoMywgdSwgeCwgcylgLAogICAgd2hlcmUgYHVgLCBgeGAsIGFuZCBgc2AgaGF2ZSB0aGUgc2FtZSBtZWFuaW5nIGFzIGZvciBgYWRkcl9zdGRgLgotfQoKOzs7IExvYWRzIGZyb20gc2xpY2UgW3NdIHRoZSBvbmx5IHByZWZpeCB0aGF0IGlzIGEgdmFsaWQgYE1zZ0FkZHJlc3NgLAo7OzsgYW5kIHJldHVybnMgYm90aCB0aGlzIHByZWZpeCBgcydgIGFuZCB0aGUgcmVtYWluZGVyIGBzJydgIG9mIFtzXSBhcyBzbGljZXMuCihzbGljZSwgc2xpY2UpIGxvYWRfbXNnX2FkZHIoc2xpY2UgcykgYXNtKCAtPiAxIDApICJMRE1TR0FERFIiOwoKOzs7IERlY29tcG9zZXMgc2xpY2UgW3NdIGNvbnRhaW5pbmcgYSB2YWxpZCBgTXNnQWRkcmVzc2AgaW50byBhIGB0dXBsZSB0YCB3aXRoIHNlcGFyYXRlIGZpZWxkcyBvZiB0aGlzIGBNc2dBZGRyZXNzYC4KOzs7IElmIFtzXSBpcyBub3QgYSB2YWxpZCBgTXNnQWRkcmVzc2AsIGEgY2VsbCBkZXNlcmlhbGl6YXRpb24gZXhjZXB0aW9uIGlzIHRocm93bi4KdHVwbGUgcGFyc2VfYWRkcihzbGljZSBzKSBhc20gIlBBUlNFTVNHQUREUiI7Cgo7OzsgUGFyc2VzIHNsaWNlIFtzXSBjb250YWluaW5nIGEgdmFsaWQgYE1zZ0FkZHJlc3NJbnRgICh1c3VhbGx5IGEgYG1zZ19hZGRyX3N0ZGApLAo7OzsgYXBwbGllcyByZXdyaXRpbmcgZnJvbSB0aGUgYW55Y2FzdCAoaWYgcHJlc2VudCkgdG8gdGhlIHNhbWUtbGVuZ3RoIHByZWZpeCBvZiB0aGUgYWRkcmVzcywKOzs7IGFuZCByZXR1cm5zIGJvdGggdGhlIHdvcmtjaGFpbiBhbmQgdGhlIDI1Ni1iaXQgYWRkcmVzcyBhcyBpbnRlZ2Vycy4KOzs7IElmIHRoZSBhZGRyZXNzIGlzIG5vdCAyNTYtYml0LCBvciBpZiBbc10gaXMgbm90IGEgdmFsaWQgc2VyaWFsaXphdGlvbiBvZiBgTXNnQWRkcmVzc0ludGAsCjs7OyB0aHJvd3MgYSBjZWxsIGRlc2VyaWFsaXphdGlvbiBleGNlcHRpb24uCihpbnQsIGludCkgcGFyc2Vfc3RkX2FkZHIoc2xpY2UgcykgYXNtICJSRVdSSVRFU1REQUREUiI7Cgo7OzsgQSB2YXJpYW50IG9mIFtwYXJzZV9zdGRfYWRkcl0gdGhhdCByZXR1cm5zIHRoZSAocmV3cml0dGVuKSBhZGRyZXNzIGFzIGEgc2xpY2UgW3NdLAo7OzsgZXZlbiBpZiBpdCBpcyBub3QgZXhhY3RseSAyNTYgYml0IGxvbmcgKHJlcHJlc2VudGVkIGJ5IGEgYG1zZ19hZGRyX3ZhcmApLgooaW50LCBzbGljZSkgcGFyc2VfdmFyX2FkZHIoc2xpY2UgcykgYXNtICJSRVdSSVRFVkFSQUREUiI7Cgp7LQogICMgRGljdGlvbmFyeSBwcmltaXRpdmVzCi19CgoKOzs7IFNldHMgdGhlIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBba2V5X2xlbl0tYml0IGtleSBzaWduZWQgaW5kZXggaW4gZGljdGlvbmFyeSBbZGljdF0gdG8gW3ZhbHVlXSAoY2VsbCksCjs7OyBhbmQgcmV0dXJucyB0aGUgcmVzdWx0aW5nIGRpY3Rpb25hcnkuCmNlbGwgaWRpY3Rfc2V0X3JlZihjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgsIGNlbGwgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSVNFVFJFRiI7CihjZWxsLCAoKSkgfmlkaWN0X3NldF9yZWYoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBjZWxsIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElTRVRSRUYiOwoKOzs7IFNldHMgdGhlIHZhbHVlIGFzc29jaWF0ZWQgd2l0aCBba2V5X2xlbl0tYml0IGtleSB1bnNpZ25lZCBpbmRleCBpbiBkaWN0aW9uYXJ5IFtkaWN0XSB0byBbdmFsdWVdIChjZWxsKSwKOzs7IGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgZGljdGlvbmFyeS4KY2VsbCB1ZGljdF9zZXRfcmVmKGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgY2VsbCB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RVU0VUUkVGIjsKKGNlbGwsICgpKSB+dWRpY3Rfc2V0X3JlZihjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgsIGNlbGwgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVVNFVFJFRiI7CgpjZWxsIGlkaWN0X2dldF9yZWYoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4KSBhc20oaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElHRVRPUFRSRUYiOwooY2VsbCwgaW50KSBpZGljdF9nZXRfcmVmPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgpIGFzbShpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSUdFVFJFRiIgIk5VTExTV0FQSUZOT1QiOwooY2VsbCwgaW50KSB1ZGljdF9nZXRfcmVmPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgpIGFzbShpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVUdFVFJFRiIgIk5VTExTV0FQSUZOT1QiOwooY2VsbCwgY2VsbCkgaWRpY3Rfc2V0X2dldF9yZWYoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBjZWxsIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElTRVRHRVRPUFRSRUYiOwooY2VsbCwgY2VsbCkgdWRpY3Rfc2V0X2dldF9yZWYoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBjZWxsIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFVTRVRHRVRPUFRSRUYiOwooY2VsbCwgaW50KSBpZGljdF9kZWxldGU/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCkgYXNtKGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RJREVMIjsKKGNlbGwsIGludCkgdWRpY3RfZGVsZXRlPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgpIGFzbShpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVURFTCI7CihzbGljZSwgaW50KSBpZGljdF9nZXQ/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCkgYXNtKGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RJR0VUIiAiTlVMTFNXQVBJRk5PVCI7CihzbGljZSwgaW50KSB1ZGljdF9nZXQ/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCkgYXNtKGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RVR0VUIiAiTlVMTFNXQVBJRk5PVCI7CihjZWxsLCBzbGljZSwgaW50KSBpZGljdF9kZWxldGVfZ2V0PyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgpIGFzbShpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSURFTEdFVCIgIk5VTExTV0FQSUZOT1QiOwooY2VsbCwgc2xpY2UsIGludCkgdWRpY3RfZGVsZXRlX2dldD8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4KSBhc20oaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFVERUxHRVQiICJOVUxMU1dBUElGTk9UIjsKKGNlbGwsIChzbGljZSwgaW50KSkgfmlkaWN0X2RlbGV0ZV9nZXQ/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCkgYXNtKGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RJREVMR0VUIiAiTlVMTFNXQVBJRk5PVCI7CihjZWxsLCAoc2xpY2UsIGludCkpIH51ZGljdF9kZWxldGVfZ2V0PyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgpIGFzbShpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVURFTEdFVCIgIk5VTExTV0FQSUZOT1QiOwpjZWxsIHVkaWN0X3NldChjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgsIHNsaWNlIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFVTRVQiOwooY2VsbCwgKCkpIH51ZGljdF9zZXQoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBzbGljZSB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RVU0VUIjsKY2VsbCBpZGljdF9zZXQoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBzbGljZSB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RJU0VUIjsKKGNlbGwsICgpKSB+aWRpY3Rfc2V0KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgc2xpY2UgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSVNFVCI7CmNlbGwgZGljdF9zZXQoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgc2xpY2UgaW5kZXgsIHNsaWNlIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFNFVCI7CihjZWxsLCAoKSkgfmRpY3Rfc2V0KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIHNsaWNlIGluZGV4LCBzbGljZSB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RTRVQiOwooY2VsbCwgaW50KSB1ZGljdF9hZGQ/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgc2xpY2UgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVUFERCI7CihjZWxsLCBpbnQpIHVkaWN0X3JlcGxhY2U/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgc2xpY2UgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVVJFUExBQ0UiOwooY2VsbCwgaW50KSBpZGljdF9hZGQ/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgc2xpY2UgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSUFERCI7CihjZWxsLCBpbnQpIGlkaWN0X3JlcGxhY2U/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgc2xpY2UgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUSVJFUExBQ0UiOwpjZWxsIHVkaWN0X3NldF9idWlsZGVyKGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgYnVpbGRlciB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RVU0VUQiI7CihjZWxsLCAoKSkgfnVkaWN0X3NldF9idWlsZGVyKGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgYnVpbGRlciB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RVU0VUQiI7CmNlbGwgaWRpY3Rfc2V0X2J1aWxkZXIoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElTRVRCIjsKKGNlbGwsICgpKSB+aWRpY3Rfc2V0X2J1aWxkZXIoY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElTRVRCIjsKY2VsbCBkaWN0X3NldF9idWlsZGVyKGNlbGwgZGljdCwgaW50IGtleV9sZW4sIHNsaWNlIGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFNFVEIiOwooY2VsbCwgKCkpIH5kaWN0X3NldF9idWlsZGVyKGNlbGwgZGljdCwgaW50IGtleV9sZW4sIHNsaWNlIGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFNFVEIiOwooY2VsbCwgaW50KSB1ZGljdF9hZGRfYnVpbGRlcj8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVFVBRERCIjsKKGNlbGwsIGludCkgdWRpY3RfcmVwbGFjZV9idWlsZGVyPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgaW5kZXgsIGJ1aWxkZXIgdmFsdWUpIGFzbSh2YWx1ZSBpbmRleCBkaWN0IGtleV9sZW4pICJESUNUVVJFUExBQ0VCIjsKKGNlbGwsIGludCkgaWRpY3RfYWRkX2J1aWxkZXI/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBpbmRleCwgYnVpbGRlciB2YWx1ZSkgYXNtKHZhbHVlIGluZGV4IGRpY3Qga2V5X2xlbikgIkRJQ1RJQUREQiI7CihjZWxsLCBpbnQpIGlkaWN0X3JlcGxhY2VfYnVpbGRlcj8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IGluZGV4LCBidWlsZGVyIHZhbHVlKSBhc20odmFsdWUgaW5kZXggZGljdCBrZXlfbGVuKSAiRElDVElSRVBMQUNFQiI7CihjZWxsLCBpbnQsIHNsaWNlLCBpbnQpIHVkaWN0X2RlbGV0ZV9nZXRfbWluKGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSgtPiAwIDIgMSAzKSAiRElDVFVSRU1NSU4iICJOVUxMU1dBUElGTk9UMiI7CihjZWxsLCAoaW50LCBzbGljZSwgaW50KSkgfnVkaWN0OjpkZWxldGVfZ2V0X21pbihjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RVUkVNTUlOIiAiTlVMTFNXQVBJRk5PVDIiOwooY2VsbCwgaW50LCBzbGljZSwgaW50KSBpZGljdF9kZWxldGVfZ2V0X21pbihjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RJUkVNTUlOIiAiTlVMTFNXQVBJRk5PVDIiOwooY2VsbCwgKGludCwgc2xpY2UsIGludCkpIH5pZGljdDo6ZGVsZXRlX2dldF9taW4oY2VsbCBkaWN0LCBpbnQga2V5X2xlbikgYXNtKC0+IDAgMiAxIDMpICJESUNUSVJFTU1JTiIgIk5VTExTV0FQSUZOT1QyIjsKKGNlbGwsIHNsaWNlLCBzbGljZSwgaW50KSBkaWN0X2RlbGV0ZV9nZXRfbWluKGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSgtPiAwIDIgMSAzKSAiRElDVFJFTU1JTiIgIk5VTExTV0FQSUZOT1QyIjsKKGNlbGwsIChzbGljZSwgc2xpY2UsIGludCkpIH5kaWN0OjpkZWxldGVfZ2V0X21pbihjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RSRU1NSU4iICJOVUxMU1dBUElGTk9UMiI7CihjZWxsLCBpbnQsIHNsaWNlLCBpbnQpIHVkaWN0X2RlbGV0ZV9nZXRfbWF4KGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSgtPiAwIDIgMSAzKSAiRElDVFVSRU1NQVgiICJOVUxMU1dBUElGTk9UMiI7CihjZWxsLCAoaW50LCBzbGljZSwgaW50KSkgfnVkaWN0OjpkZWxldGVfZ2V0X21heChjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RVUkVNTUFYIiAiTlVMTFNXQVBJRk5PVDIiOwooY2VsbCwgaW50LCBzbGljZSwgaW50KSBpZGljdF9kZWxldGVfZ2V0X21heChjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RJUkVNTUFYIiAiTlVMTFNXQVBJRk5PVDIiOwooY2VsbCwgKGludCwgc2xpY2UsIGludCkpIH5pZGljdDo6ZGVsZXRlX2dldF9tYXgoY2VsbCBkaWN0LCBpbnQga2V5X2xlbikgYXNtKC0+IDAgMiAxIDMpICJESUNUSVJFTU1BWCIgIk5VTExTV0FQSUZOT1QyIjsKKGNlbGwsIHNsaWNlLCBzbGljZSwgaW50KSBkaWN0X2RlbGV0ZV9nZXRfbWF4KGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSgtPiAwIDIgMSAzKSAiRElDVFJFTU1BWCIgIk5VTExTV0FQSUZOT1QyIjsKKGNlbGwsIChzbGljZSwgc2xpY2UsIGludCkpIH5kaWN0OjpkZWxldGVfZ2V0X21heChjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20oLT4gMCAyIDEgMykgIkRJQ1RSRU1NQVgiICJOVUxMU1dBUElGTk9UMiI7CihpbnQsIHNsaWNlLCBpbnQpIHVkaWN0X2dldF9taW4/KGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSAoLT4gMSAwIDIpICJESUNUVU1JTiIgIk5VTExTV0FQSUZOT1QyIjsKKGludCwgc2xpY2UsIGludCkgdWRpY3RfZ2V0X21heD8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbikgYXNtICgtPiAxIDAgMikgIkRJQ1RVTUFYIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBjZWxsLCBpbnQpIHVkaWN0X2dldF9taW5fcmVmPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20gKC0+IDEgMCAyKSAiRElDVFVNSU5SRUYiICJOVUxMU1dBUElGTk9UMiI7CihpbnQsIGNlbGwsIGludCkgdWRpY3RfZ2V0X21heF9yZWY/KGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSAoLT4gMSAwIDIpICJESUNUVU1BWFJFRiIgIk5VTExTV0FQSUZOT1QyIjsKKGludCwgc2xpY2UsIGludCkgaWRpY3RfZ2V0X21pbj8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbikgYXNtICgtPiAxIDAgMikgIkRJQ1RJTUlOIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBzbGljZSwgaW50KSBpZGljdF9nZXRfbWF4PyhjZWxsIGRpY3QsIGludCBrZXlfbGVuKSBhc20gKC0+IDEgMCAyKSAiRElDVElNQVgiICJOVUxMU1dBUElGTk9UMiI7CihpbnQsIGNlbGwsIGludCkgaWRpY3RfZ2V0X21pbl9yZWY/KGNlbGwgZGljdCwgaW50IGtleV9sZW4pIGFzbSAoLT4gMSAwIDIpICJESUNUSU1JTlJFRiIgIk5VTExTV0FQSUZOT1QyIjsKKGludCwgY2VsbCwgaW50KSBpZGljdF9nZXRfbWF4X3JlZj8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbikgYXNtICgtPiAxIDAgMikgIkRJQ1RJTUFYUkVGIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBzbGljZSwgaW50KSB1ZGljdF9nZXRfbmV4dD8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IHBpdm90KSBhc20ocGl2b3QgZGljdCBrZXlfbGVuIC0+IDEgMCAyKSAiRElDVFVHRVRORVhUIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBzbGljZSwgaW50KSB1ZGljdF9nZXRfbmV4dGVxPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgcGl2b3QpIGFzbShwaXZvdCBkaWN0IGtleV9sZW4gLT4gMSAwIDIpICJESUNUVUdFVE5FWFRFUSIgIk5VTExTV0FQSUZOT1QyIjsKKGludCwgc2xpY2UsIGludCkgdWRpY3RfZ2V0X3ByZXY/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBwaXZvdCkgYXNtKHBpdm90IGRpY3Qga2V5X2xlbiAtPiAxIDAgMikgIkRJQ1RVR0VUUFJFViIgIk5VTExTV0FQSUZOT1QyIjsKKGludCwgc2xpY2UsIGludCkgdWRpY3RfZ2V0X3ByZXZlcT8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IHBpdm90KSBhc20ocGl2b3QgZGljdCBrZXlfbGVuIC0+IDEgMCAyKSAiRElDVFVHRVRQUkVWRVEiICJOVUxMU1dBUElGTk9UMiI7CihpbnQsIHNsaWNlLCBpbnQpIGlkaWN0X2dldF9uZXh0PyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgcGl2b3QpIGFzbShwaXZvdCBkaWN0IGtleV9sZW4gLT4gMSAwIDIpICJESUNUSUdFVE5FWFQiICJOVUxMU1dBUElGTk9UMiI7CihpbnQsIHNsaWNlLCBpbnQpIGlkaWN0X2dldF9uZXh0ZXE/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIGludCBwaXZvdCkgYXNtKHBpdm90IGRpY3Qga2V5X2xlbiAtPiAxIDAgMikgIkRJQ1RJR0VUTkVYVEVRIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBzbGljZSwgaW50KSBpZGljdF9nZXRfcHJldj8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgaW50IHBpdm90KSBhc20ocGl2b3QgZGljdCBrZXlfbGVuIC0+IDEgMCAyKSAiRElDVElHRVRQUkVWIiAiTlVMTFNXQVBJRk5PVDIiOwooaW50LCBzbGljZSwgaW50KSBpZGljdF9nZXRfcHJldmVxPyhjZWxsIGRpY3QsIGludCBrZXlfbGVuLCBpbnQgcGl2b3QpIGFzbShwaXZvdCBkaWN0IGtleV9sZW4gLT4gMSAwIDIpICJESUNUSUdFVFBSRVZFUSIgIk5VTExTV0FQSUZOT1QyIjsKCjs7OyBDcmVhdGVzIGFuIGVtcHR5IGRpY3Rpb25hcnksIHdoaWNoIGlzIGFjdHVhbGx5IGEgbnVsbCB2YWx1ZS4gRXF1aXZhbGVudCB0byBQVVNITlVMTApjZWxsIG5ld19kaWN0KCkgYXNtICJORVdESUNUIjsKOzs7IENoZWNrcyB3aGV0aGVyIGEgZGljdGlvbmFyeSBpcyBlbXB0eS4gRXF1aXZhbGVudCB0byBjZWxsX251bGw/LgppbnQgZGljdF9lbXB0eT8oY2VsbCBjKSBhc20gIkRJQ1RFTVBUWSI7CgoKey0gUHJlZml4IGRpY3Rpb25hcnkgcHJpbWl0aXZlcyAtfQooc2xpY2UsIHNsaWNlLCBzbGljZSwgaW50KSBwZnhkaWN0X2dldD8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgc2xpY2Uga2V5KSBhc20oa2V5IGRpY3Qga2V5X2xlbikgIlBGWERJQ1RHRVRRIiAiTlVMTFNXQVBJRk5PVDIiOwooY2VsbCwgaW50KSBwZnhkaWN0X3NldD8oY2VsbCBkaWN0LCBpbnQga2V5X2xlbiwgc2xpY2Uga2V5LCBzbGljZSB2YWx1ZSkgYXNtKHZhbHVlIGtleSBkaWN0IGtleV9sZW4pICJQRlhESUNUU0VUIjsKKGNlbGwsIGludCkgcGZ4ZGljdF9kZWxldGU/KGNlbGwgZGljdCwgaW50IGtleV9sZW4sIHNsaWNlIGtleSkgYXNtKGtleSBkaWN0IGtleV9sZW4pICJQRlhESUNUREVMIjsKCjs7OyBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZ2xvYmFsIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyIHdpdGggaW50ZWdlciBpbmRleCBgaWAgYXMgYSBgY2VsbGAgb3IgYG51bGxgIHZhbHVlLgpjZWxsIGNvbmZpZ19wYXJhbShpbnQgeCkgYXNtICJDT05GSUdPUFRQQVJBTSI7Cjs7OyBDaGVja3Mgd2hldGhlciBjIGlzIGEgbnVsbC4gTm90ZSwgdGhhdCBGdW5DIGFsc28gaGFzIHBvbHltb3JwaGljIG51bGw/IGJ1aWx0LWluLgppbnQgY2VsbF9udWxsPyhjZWxsIGMpIGFzbSAiSVNOVUxMIjsKCjs7OyBDcmVhdGVzIGFuIG91dHB1dCBhY3Rpb24gd2hpY2ggd291bGQgcmVzZXJ2ZSBleGFjdGx5IGFtb3VudCBuYW5vdG9uY29pbnMgKGlmIG1vZGUgPSAwKSwgYXQgbW9zdCBhbW91bnQgbmFub3RvbmNvaW5zIChpZiBtb2RlID0gMiksIG9yIGFsbCBidXQgYW1vdW50IG5hbm90b25jb2lucyAoaWYgbW9kZSA9IDEgb3IgbW9kZSA9IDMpLCBmcm9tIHRoZSByZW1haW5pbmcgYmFsYW5jZSBvZiB0aGUgYWNjb3VudC4gSXQgaXMgcm91Z2hseSBlcXVpdmFsZW50IHRvIGNyZWF0aW5nIGFuIG91dGJvdW5kIG1lc3NhZ2UgY2FycnlpbmcgYW1vdW50IG5hbm90b25jb2lucyAob3IgYiAgYW1vdW50IG5hbm90b25jb2lucywgd2hlcmUgYiBpcyB0aGUgcmVtYWluaW5nIGJhbGFuY2UpIHRvIG9uZXNlbGYsIHNvIHRoYXQgdGhlIHN1YnNlcXVlbnQgb3V0cHV0IGFjdGlvbnMgd291bGQgbm90IGJlIGFibGUgdG8gc3BlbmQgbW9yZSBtb25leSB0aGFuIHRoZSByZW1haW5kZXIuIEJpdCArMiBpbiBtb2RlIG1lYW5zIHRoYXQgdGhlIGV4dGVybmFsIGFjdGlvbiBkb2VzIG5vdCBmYWlsIGlmIHRoZSBzcGVjaWZpZWQgYW1vdW50IGNhbm5vdCBiZSByZXNlcnZlZDsgaW5zdGVhZCwgYWxsIHJlbWFpbmluZyBiYWxhbmNlIGlzIHJlc2VydmVkLiBCaXQgKzggaW4gbW9kZSBtZWFucyBgYW1vdW50IDwtIC1hbW91bnRgIGJlZm9yZSBwZXJmb3JtaW5nIGFueSBmdXJ0aGVyIGFjdGlvbnMuIEJpdCArNCBpbiBtb2RlIG1lYW5zIHRoYXQgYW1vdW50IGlzIGluY3JlYXNlZCBieSB0aGUgb3JpZ2luYWwgYmFsYW5jZSBvZiB0aGUgY3VycmVudCBhY2NvdW50IChiZWZvcmUgdGhlIGNvbXB1dGUgcGhhc2UpLCBpbmNsdWRpbmcgYWxsIGV4dHJhIGN1cnJlbmNpZXMsIGJlZm9yZSBwZXJmb3JtaW5nIGFueSBvdGhlciBjaGVja3MgYW5kIGFjdGlvbnMuIEN1cnJlbnRseSwgYW1vdW50IG11c3QgYmUgYSBub24tbmVnYXRpdmUgaW50ZWdlciwgYW5kIG1vZGUgbXVzdCBiZSBpbiB0aGUgcmFuZ2UgMC4uMTUuCigpIHJhd19yZXNlcnZlKGludCBhbW91bnQsIGludCBtb2RlKSBpbXB1cmUgYXNtICJSQVdSRVNFUlZFIjsKOzs7IFNpbWlsYXIgdG8gcmF3X3Jlc2VydmUsIGJ1dCBhbHNvIGFjY2VwdHMgYSBkaWN0aW9uYXJ5IGV4dHJhX2Ftb3VudCAocmVwcmVzZW50ZWQgYnkgYSBjZWxsIG9yIG51bGwpIHdpdGggZXh0cmEgY3VycmVuY2llcy4gSW4gdGhpcyB3YXkgY3VycmVuY2llcyBvdGhlciB0aGFuIFRvbkNvaW4gY2FuIGJlIHJlc2VydmVkLgooKSByYXdfcmVzZXJ2ZV9leHRyYShpbnQgYW1vdW50LCBjZWxsIGV4dHJhX2Ftb3VudCwgaW50IG1vZGUpIGltcHVyZSBhc20gIlJBV1JFU0VSVkVYIjsKOzs7IFNlbmRzIGEgcmF3IG1lc3NhZ2UgY29udGFpbmVkIGluIG1zZywgd2hpY2ggc2hvdWxkIGNvbnRhaW4gYSBjb3JyZWN0bHkgc2VyaWFsaXplZCBvYmplY3QgTWVzc2FnZSBYLCB3aXRoIHRoZSBvbmx5IGV4Y2VwdGlvbiB0aGF0IHRoZSBzb3VyY2UgYWRkcmVzcyBpcyBhbGxvd2VkIHRvIGhhdmUgZHVtbXkgdmFsdWUgYWRkcl9ub25lICh0byBiZSBhdXRvbWF0aWNhbGx5IHJlcGxhY2VkIHdpdGggdGhlIGN1cnJlbnQgc21hcnQgY29udHJhY3QgYWRkcmVzcyksIGFuZCBpaHJfZmVlLCBmd2RfZmVlLCBjcmVhdGVkX2x0IGFuZCBjcmVhdGVkX2F0IGZpZWxkcyBjYW4gaGF2ZSBhcmJpdHJhcnkgdmFsdWVzICh0byBiZSByZXdyaXR0ZW4gd2l0aCBjb3JyZWN0IHZhbHVlcyBkdXJpbmcgdGhlIGFjdGlvbiBwaGFzZSBvZiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbikuIEludGVnZXIgcGFyYW1ldGVyIG1vZGUgY29udGFpbnMgdGhlIGZsYWdzLiBDdXJyZW50bHkgbW9kZSA9IDAgaXMgdXNlZCBmb3Igb3JkaW5hcnkgbWVzc2FnZXM7IG1vZGUgPSAxMjggaXMgdXNlZCBmb3IgbWVzc2FnZXMgdGhhdCBhcmUgdG8gY2FycnkgYWxsIHRoZSByZW1haW5pbmcgYmFsYW5jZSBvZiB0aGUgY3VycmVudCBzbWFydCBjb250cmFjdCAoaW5zdGVhZCBvZiB0aGUgdmFsdWUgb3JpZ2luYWxseSBpbmRpY2F0ZWQgaW4gdGhlIG1lc3NhZ2UpOyBtb2RlID0gNjQgaXMgdXNlZCBmb3IgbWVzc2FnZXMgdGhhdCBjYXJyeSBhbGwgdGhlIHJlbWFpbmluZyB2YWx1ZSBvZiB0aGUgaW5ib3VuZCBtZXNzYWdlIGluIGFkZGl0aW9uIHRvIHRoZSB2YWx1ZSBpbml0aWFsbHkgaW5kaWNhdGVkIGluIHRoZSBuZXcgbWVzc2FnZSAoaWYgYml0IDAgaXMgbm90IHNldCwgdGhlIGdhcyBmZWVzIGFyZSBkZWR1Y3RlZCBmcm9tIHRoaXMgYW1vdW50KTsgbW9kZScgPSBtb2RlICsgMSBtZWFucyB0aGF0IHRoZSBzZW5kZXIgd2FudHMgdG8gcGF5IHRyYW5zZmVyIGZlZXMgc2VwYXJhdGVseTsgbW9kZScgPSBtb2RlICsgMiBtZWFucyB0aGF0IGFueSBlcnJvcnMgYXJpc2luZyB3aGlsZSBwcm9jZXNzaW5nIHRoaXMgbWVzc2FnZSBkdXJpbmcgdGhlIGFjdGlvbiBwaGFzZSBzaG91bGQgYmUgaWdub3JlZC4gRmluYWxseSwgbW9kZScgPSBtb2RlICsgMzIgbWVhbnMgdGhhdCB0aGUgY3VycmVudCBhY2NvdW50IG11c3QgYmUgZGVzdHJveWVkIGlmIGl0cyByZXN1bHRpbmcgYmFsYW5jZSBpcyB6ZXJvLiBUaGlzIGZsYWcgaXMgdXN1YWxseSBlbXBsb3llZCB0b2dldGhlciB3aXRoICsxMjguCigpIHNlbmRfcmF3X21lc3NhZ2UoY2VsbCBtc2csIGludCBtb2RlKSBpbXB1cmUgYXNtICJTRU5EUkFXTVNHIjsKOzs7IENyZWF0ZXMgYW4gb3V0cHV0IGFjdGlvbiB0aGF0IHdvdWxkIGNoYW5nZSB0aGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgdG8gdGhhdCBnaXZlbiBieSBjZWxsIG5ld19jb2RlLiBOb3RpY2UgdGhhdCB0aGlzIGNoYW5nZSB3aWxsIHRha2UgZWZmZWN0IG9ubHkgYWZ0ZXIgdGhlIHN1Y2Nlc3NmdWwgdGVybWluYXRpb24gb2YgdGhlIGN1cnJlbnQgcnVuIG9mIHRoZSBzbWFydCBjb250cmFjdAooKSBzZXRfY29kZShjZWxsIG5ld19jb2RlKSBpbXB1cmUgYXNtICJTRVRDT0RFIjsKCjs7OyBHZW5lcmF0ZXMgYSBuZXcgcHNldWRvLXJhbmRvbSB1bnNpZ25lZCAyNTYtYml0IGludGVnZXIgeC4gVGhlIGFsZ29yaXRobSBpcyBhcyBmb2xsb3dzOiBpZiByIGlzIHRoZSBvbGQgdmFsdWUgb2YgdGhlIHJhbmRvbSBzZWVkLCBjb25zaWRlcmVkIGFzIGEgMzItYnl0ZSBhcnJheSAoYnkgY29uc3RydWN0aW5nIHRoZSBiaWctZW5kaWFuIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2lnbmVkIDI1Ni1iaXQgaW50ZWdlciksIHRoZW4gaXRzIHNoYTUxMihyKSBpcyBjb21wdXRlZDsgdGhlIGZpcnN0IDMyIGJ5dGVzIG9mIHRoaXMgaGFzaCBhcmUgc3RvcmVkIGFzIHRoZSBuZXcgdmFsdWUgcicgb2YgdGhlIHJhbmRvbSBzZWVkLCBhbmQgdGhlIHJlbWFpbmluZyAzMiBieXRlcyBhcmUgcmV0dXJuZWQgYXMgdGhlIG5leHQgcmFuZG9tIHZhbHVlIHguCmludCByYW5kb20oKSBpbXB1cmUgYXNtICJSQU5EVTI1NiI7Cjs7OyBHZW5lcmF0ZXMgYSBuZXcgcHNldWRvLXJhbmRvbSBpbnRlZ2VyIHogaW4gdGhlIHJhbmdlIDAuLnJhbmdlMSAob3IgcmFuZ2UuLjEsIGlmIHJhbmdlIDwgMCkuIE1vcmUgcHJlY2lzZWx5LCBhbiB1bnNpZ25lZCByYW5kb20gdmFsdWUgeCBpcyBnZW5lcmF0ZWQgYXMgaW4gcmFuZG9tOyB0aGVuIHogOj0geCAqIHJhbmdlIC8gMl4yNTYgaXMgY29tcHV0ZWQuCmludCByYW5kKGludCByYW5nZSkgaW1wdXJlIGFzbSAiUkFORCI7Cjs7OyBSZXR1cm5zIHRoZSBjdXJyZW50IHJhbmRvbSBzZWVkIGFzIGFuIHVuc2lnbmVkIDI1Ni1iaXQgSW50ZWdlci4KaW50IGdldF9zZWVkKCkgaW1wdXJlIGFzbSAiUkFORFNFRUQiOwo7OzsgU2V0cyB0aGUgcmFuZG9tIHNlZWQgdG8gdW5zaWduZWQgMjU2LWJpdCBzZWVkLgooKSBzZXRfc2VlZChpbnQpIGltcHVyZSBhc20gIlNFVFJBTkQiOwo7OzsgTWl4ZXMgdW5zaWduZWQgMjU2LWJpdCBpbnRlZ2VyIHggaW50byB0aGUgcmFuZG9tIHNlZWQgciBieSBzZXR0aW5nIHRoZSByYW5kb20gc2VlZCB0byBzaGEyNTYgb2YgdGhlIGNvbmNhdGVuYXRpb24gb2YgdHdvIDMyLWJ5dGUgc3RyaW5nczogdGhlIGZpcnN0IHdpdGggdGhlIGJpZy1lbmRpYW4gcmVwcmVzZW50YXRpb24gb2YgdGhlIG9sZCBzZWVkIHIsIGFuZCB0aGUgc2Vjb25kIHdpdGggdGhlIGJpZy1lbmRpYW4gcmVwcmVzZW50YXRpb24gb2YgeC4KKCkgcmFuZG9taXplKGludCB4KSBpbXB1cmUgYXNtICJBRERSQU5EIjsKOzs7IEVxdWl2YWxlbnQgdG8gcmFuZG9taXplKGN1cl9sdCgpKTsuCigpIHJhbmRvbWl6ZV9sdCgpIGltcHVyZSBhc20gIkxUSU1FIiAiQUREUkFORCI7Cgo7OzsgQ2hlY2tzIHdoZXRoZXIgdGhlIGRhdGEgcGFydHMgb2YgdHdvIHNsaWNlcyBjb2luc2lkZQppbnQgZXF1YWxfc2xpY2VfYml0cyAoc2xpY2UgYSwgc2xpY2UgYikgYXNtICJTREVRIjsKCjs7OyBDb25jYXRlbmF0ZXMgdHdvIGJ1aWxkZXJzCmJ1aWxkZXIgc3RvcmVfYnVpbGRlcihidWlsZGVyIHRvLCBidWlsZGVyIGZyb20pIGFzbSAiU1RCUiI7Cg==`;

const contractTsSample = `#include "stdlib.fc";

const op::increase = "op::increase"c; ;; create an opcode from string using the "c" prefix, this results in 0x7e8764ef opcode in this case

;; storage variables

;; id is required to be able to create different instances of counters
;; since addresses in TON depend on the initial state of the contract
global int ctx_id;
global int ctx_counter;

;; load_data populates storage variables using stored data
() load_data() impure {
    var ds = get_data().begin_parse();

    ctx_id = ds~load_uint(32);
    ctx_counter = ds~load_uint(32);

    ds.end_parse();
}

;; save_data stores storage variables as a cell into persistent storage
() save_data() impure {
    set_data(
        begin_cell()
            .store_uint(ctx_id, 32)
            .store_uint(ctx_counter, 32)
            .end_cell()
    );
}

;; recv_internal is the main function of the contract and is called when it receives a message from other contracts
() recv_internal(int my_balance, int msg_value, cell in_msg_full, slice in_msg_body) impure {
    if (in_msg_body.slice_empty?()) { ;; ignore all empty messages
        return ();
    }

    slice cs = in_msg_full.begin_parse();
    int flags = cs~load_uint(4);
    if (flags & 1) { ;; ignore all bounced messages
        return ();
    }

    load_data(); ;; here we populate the storage variables

    int op = in_msg_body~load_uint(32); ;; by convention, the first 32 bits of incoming message is the op
    int query_id = in_msg_body~load_uint(64); ;; also by convention, the next 64 bits contain the "query id", although this is not always the case

    if (op == op::increase) {
        int increase_by = in_msg_body~load_uint(32);
        ctx_counter += increase_by;
        save_data();
        return ();
    }

    throw(0xffff); ;; if the message contains an op that is not known to this contract, we throw
}

;; get methods are a means to conveniently read contract data using, for example, HTTP APIs
;; they are marked with method_id
;; note that unlike in many other smart contract VMs, get methods cannot be called by other contracts

int get_counter() method_id {
    load_data();
    return ctx_counter;
}

int get_id() method_id {
    load_data();
    return ctx_id;
}

`;

const contractSampleBlank = `#include "stdlib.fc";

() recv_internal(int my_balance, int msg_value, cell in_msg_full, slice in_msg_body) impure {

}`;

export const commonProjectFiles = [
  {
    id: '100',
    name: 'stateInit.cell.ts',
    parent: null,
    type: 'file' as const,
    path: 'stateInit.cell.ts',
    content: `import { beginCell } from "@ton/core";

const cell = beginCell().endCell();

export default cell;`,
    disableActions: true,
  },
  {
    id: '101',
    name: 'message.cell.ts',
    parent: null,
    type: 'file' as const,
    path: 'message.cell.ts',
    content: `import { beginCell } from "@ton/core";

const cell = beginCell().endCell();

export default cell;`,
    disableActions: true,
  },
];

export const ProjectTemplate = {
  tonBlank: {
    func: [
      {
        id: '1',
        name: 'main.fc',
        parent: null,
        type: 'file' as const,
        path: 'main.fc',
        content: contractSampleBlank,
      },
      {
        id: '2',
        name: 'stdlib.fc',
        parent: null,
        type: 'file' as const,
        path: 'stdlib.fc',
        content: decodeBase64(stdlibContent),
      },
      {
        id: '3',
        name: 'tests',
        parent: null,
        type: 'directory' as const,
        path: 'tests',
        content: '',
      },
      {
        id: '4',
        name: 'BlankContract.ts',
        parent: '3',
        type: 'file' as const,
        path: 'tests/BlankContract.ts',
        content: BlankContract.testScript,
      },
      {
        id: '5',
        name: 'BlankContract.spec.ts',
        parent: '3',
        type: 'file' as const,
        path: 'tests/BlankContract.spec.ts',
        content: BlankContract.testCases,
      },
      ...commonProjectFiles,
    ],
    tact: [
      {
        id: '1',
        name: 'main.tact',
        parent: null,
        type: 'file' as const,
        path: 'main.tact',
        content: TactBlankContract.code,
      },
      {
        id: '2',
        name: 'tests',
        parent: null,
        type: 'directory' as const,
        path: 'tests',
        content: '',
      },
      {
        id: '3',
        name: 'default.spec.ts',
        parent: '2',
        type: 'file' as const,
        path: 'tests/default.spec.ts',
        content: BlankContract.tactTestCase,
      },
    ],
  },
  tonCounter: {
    func: [
      {
        id: '1',
        name: 'main.fc',
        parent: null,
        type: 'file' as const,
        path: 'main.fc',
        content: contractTsSample,
      },
      {
        id: '2',
        name: 'stateInit.cell.ts',
        parent: null,
        type: 'file' as const,
        path: 'stateInit.cell.ts',
        content: `import { beginCell } from "@ton/core";

const cell = beginCell()
      .storeUint(1, 32)
      .storeUint(0, 32)
      .endCell();

export default cell;`,
        disableActions: true,
      },
      {
        id: '3',
        name: 'message.cell.ts',
        parent: null,
        type: 'file' as const,
        path: 'message.cell.ts',
        content: `import { beginCell } from "@ton/core";

const cell = beginCell()
        .storeUint('0x7e8764ef', 32) // op (op #0x7e8764ef = increment)
        .storeUint(1, 64) // query id
        .storeUint(4, 32) // increase by
        .endCell();
        
export default cell;`,
        disableActions: true,
      },
      {
        id: '4',
        name: 'stdlib.fc',
        parent: null,
        type: 'file' as const,
        path: 'stdlib.fc',
        content: decodeBase64(stdlibContent),
      },
      {
        id: '5',
        name: 'tests',
        parent: null,
        type: 'directory' as const,
        path: 'tests',
        content: '',
      },
      {
        id: '6',
        name: 'CounterContract.ts',
        parent: '5',
        type: 'file' as const,
        path: 'tests/CounterContract.ts',
        content: CounterContract.testScript,
      },
      {
        id: '7',
        name: 'CounterContract.spec.ts',
        parent: '5',
        type: 'file' as const,
        path: 'tests/CounterContract.spec.ts',
        content: CounterContract.testCases,
      },
    ],
    tact: [
      {
        id: '1',
        name: 'main.tact',
        parent: null,
        type: 'file' as const,
        path: 'main.tact',
        content: TactCounterContract.code,
      },
      {
        id: '2',
        name: 'tests',
        parent: null,
        type: 'directory' as const,
        path: 'tests',
        content: '',
      },
      {
        id: '3',
        name: 'Counter.spec.ts',
        parent: '2',
        type: 'file' as const,
        path: 'tests/Counter.spec.ts',
        content: CounterContract.tactTestCases,
      },
    ],
  },
};
